<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://unpkg.com/simpledotcss/simple.css><link rel=stylesheet href=/css/main.css><meta name=generator content="Hugo 0.140.0"><meta name=description content="minuk.dev wiki"><meta name=keywords content="hugo,site,new"><meta name=author content="Min-Uk.Lee"><title>Make Cloud Native Chaos Engineering Easier Deep Dive into Chaos Mesh |
minuk dev wiki
</title><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script></head><body><header class=header><div class=header_left><a href=/><img class=logo src=/images/Rb.png alt=logo>
MinUk.Dev</a></div><div class=header_middle>Make Cloud Native Chaos Engineering Easier Deep Dive into Chaos Mesh</div></header><main><article class=main><div class=title><h1 class=title-header>Make Cloud Native Chaos Engineering Easier Deep Dive into Chaos Mesh</h1></div><a href=https://github.com/minuk-dev/minuk-dev.github.io/blame/master/content/wiki/make-cloud-native-chaos-engineering-easier-deep-dive-into-chaos-mesh.md><h5>created : Sun, 04 Sep 2022 02:42:20 +0900</h5><h5>modified : Sun, 04 Sep 2022 03:17:07 +0900</h5></a><div class=article-meta><div class="breadcumb content"><i class="bi bi-folder"></i>
[[kubecon]]</div></div><div class=list-terms><ul><i class="bi bi-tags" title=Tags></i>
<a href=/tags/chaos-mesh class=tag-btn>chaos-mesh</a>
<a href=/tags/chaos-engineering class=tag-btn>chaos-engineering</a>
<a href=/tags/kubecon class=tag-btn>kubecon</a>
<a href=/tags/k8s class=tag-btn>k8s</a>
<a href=/tags/kubernetes class=tag-btn>kubernetes</a></ul></div><aside class=navbar id=nav-toc style=text-align:left><nav id=TableOfContents><ul><li><a href=#testing-a-distributed-system-is-difficult>Testing a distributed system is difficult</a></li><li><a href=#chaos-engieering-to-the-rescue>Chaos Engieering to the rescue</a></li><li><a href=#why-chaos-mesh>Why Chaos Mesh</a></li><li><a href=#what-is-chaos-mesh>What is Chaos Mesh</a></li><li><a href=#deep-into-chaos-mesh>Deep into Chaos Mesh</a><ul><li><a href=#architecture>Architecture</a></li><li><a href=#customresourcedeifnitions>CustomResourceDeifnitions</a></li><li><a href=#workflow-engine>Workflow Engine</a></li><li><a href=#selectors>Selectors</a></li><li><a href=#authorization>Authorization</a></li></ul></li><li><a href=#개인-의견>개인 의견</a></li></ul></nav></aside><div class=content><ul><li><a href=https://youtu.be/bZnI5omUKe4>원본</a></li></ul><h2 id=testing-a-distributed-system-is-difficult>Testing a distributed system is difficult</h2><ul><li>Distributed systems are more and more complex nowadays:<ul><li>Faults can happen anytime, anywhere, in any ways</li></ul></li><li>Writing tests and debugging is hard:<ul><li>Deterministic test is very hard and impossible to cover all faults</li></ul></li><li>But, No crash, No data loss, No wrong results</li></ul><h2 id=chaos-engieering-to-the-rescue>Chaos Engieering to the rescue</h2><ul><li>Chaos engineering is about breaking things in a controlled environment and through well-planned experiments in order to build confidence in your application to withstand turbulent conditions.</li><li>Chaos engineering is NOT about breaking things randomly without a perpose.</li><li>Program Cycle:<ul><li>Improve -> Steady State -> Hypothesis -> Run Experiment -> Verify -> Improve&mldr;</li></ul></li></ul><h2 id=why-chaos-mesh>Why Chaos Mesh</h2><ul><li><p>On Kubernetes:</p><ul><li>More application clusters (40+)</li><li>More nodes on each cluster</li><li>More target objects may fail, e.g. Container / Pod / Network / Disk / System Clock / Kernel / etc.</li></ul></li><li><p>We need more Chaos experiments. However, managing and scheduling many chaos experiments is a hug pain!</p></li><li><p>In Docker:</p><ul><li>The environment is different from the physical nodes</li><li>Tools like tc / iptables / fuse / bcc can&rsquo;t be used directly</li><li>Containers on the same node cannot affect each other</li></ul></li><li><p>Chaos scope must be customizable and manageable for containers.</p></li></ul><h2 id=what-is-chaos-mesh>What is Chaos Mesh</h2><ul><li>A Cloud-Native Chaos Engineering platform on Kubernetes environments</li><li>Started out as the internal platform to test TiDB</li><li>Provides fault injection methods into the container, Pod, network, system I/O, kernel, etc.</li><li>Chaos Mesh&rsquo;s Mission:<ul><li>Make Chaos Engineering easy</li></ul></li></ul><h2 id=deep-into-chaos-mesh>Deep into Chaos Mesh</h2><h3 id=architecture>Architecture</h3><ul><li>Chaos Dashboard:<ul><li>Manage and monitor chaos experiment</li></ul></li><li>Chaos Controller Manager:<ul><li>Schedule and controle component</li><li>Workflow engine</li></ul></li><li>Chaos Daemon:<ul><li>Executive component on kubernetes node</li></ul></li><li>Chaosd:<ul><li>Executive component on non-kubernetes node</li></ul></li></ul><h3 id=customresourcedeifnitions>CustomResourceDeifnitions</h3><ul><li>PodChaos, NetworkChaos, &mldr;</li><li>Examples</li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=#ZgotmplZ>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>chaos-mesh.org/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PodChaos</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pod-kill-example</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>action</span>: <span style=color:#ae81ff>pod-kill</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>mode</span>: <span style=color:#ae81ff>one</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>labelSelectors</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;app.kubernetes.io/component&#34;: </span><span style=color:#e6db74>&#34;tikv&#34;</span></span></span></code></pre></div></div><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=#ZgotmplZ>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>chaos-mesh.org/v1alph1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Schedule</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>schedule-pod-kill-example</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>schedule</span>: <span style=color:#e6db74>&#34;@every 5m&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#e6db74>&#34;PodChaos&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>historyLimit</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>concurrencyPolicy</span>: <span style=color:#ae81ff>Forbid</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>podChaos</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>action</span>: <span style=color:#e6db74>&#34;pod-kill&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>mode</span>: <span style=color:#ae81ff>one</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labelSelectors</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;app.kubernetes.io/component&#34;: </span><span style=color:#e6db74>&#34;tikv&#34;</span></span></span></code></pre></div></div><h3 id=workflow-engine>Workflow Engine</h3><ul><li>Three parts of the a workflow:<ul><li>Workflow Name</li><li>Entry, the entry of the whole workflow</li><li>Template array</li></ul></li><li>Five different types of templates:<ul><li>Serial</li><li>Parallel</li><li>Chaos</li><li>Suspend</li><li>Task</li></ul></li><li>Serial, Parallel, Task allow other nodes to be referenced as child nodes</li></ul><h3 id=selectors>Selectors</h3><ul><li>Namespace, Label, Expression, Annotation, Field, PodPhase, Node Selector</li><li>Node, Pod list</li></ul><h3 id=authorization>Authorization</h3><ul><li>Authorization mechanism based on Kubernetes RBAC permission policies</li></ul><hr><h2 id=개인-의견>개인 의견</h2><ul><li>강연 자체가 깔끔했다. 어떻게 동작하는지 아키텍쳐 그림만 봐도 이해가 가능할정도로 설명하고 있다.</li><li>기능 자체가 kubernetes 틱 하다. 그러면서도 web ui를 잘 제공한다고 생각한다. 개인적으로는 argo cd 같은 느낌이 들었다. dashboard 가 좋아서 시각화가 잘되고, 시각화가 잘되니까 머리속으로 어떻게 해야하는 구나가 잘 떠오르는 것 같다.</li><li>demo가 엄청 좋다. 공식 홈페이지에서 직접 해볼수 있도록 제공하는데, 어떻게 설치하는 지, 어떻게 설정하는지를 잘 보여준다.</li><li>아직 documentation 을 읽어보지는 않았지만, 이 정도만 해도 어떻게 사용하는지 감을 잡고 자잘한것 정도만 찾아보는 수준일것 같다.</li><li>생각한게 거의 다 있어서 좋았다. 강연 흐름이 들으면 궁금해할만한 순서로 잘 구성되어 있다.</li><li>예전에 Litmus를 찍먹 해본적이 있었는데 튜토리얼 경험은 이게 더 좋은것 같다. 물론 litmus chaos 가 지금은 더 널리쓰여서 써야한다면 litmus를 쓰겠지만 말이다. 개인적으로 기대가 되는 프로젝트다 2022 2월에서야 인큐베이팅 됬으니까 아직은 발전을 더 지켜봐야할듯 하다.</li></ul></div><hr><div class=list-files><ul class=section-tree></ul></div></article><script src=/js/wikilink.js></script><div><script src=https://utteranc.es/client.js repo=minuk-dev/minuk-dev.github.io issue-term=pathname theme=github-dark crossorigin=anonymous async></script></div></main><footer class=footer><div class=footer-left></div><div class=footer-right><ul class=social><li><a href=/about>About</a></li><li><a href=https://github.com/minuk-dev>Github</a></li></ul></div></footer></body><script src=/js/dir_toggle.js></script><script src=/js/codeblock_copy.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css><script type=module>
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs";
mermaid.initialize({
  startOnLoad: true,
  theme: "dark",
});
</script></html>