<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Sequelize</title><link rel=icon href=https://makerdark98.dev/images/Rb.png><meta property="og:title" content="Sequelize"><meta property="og:description" content="MD98 블로그 : Sequelize"><meta property="og:image" content="https://makerdark98.dev/images/Rb.png"><style>html body{font-family:raleway,sans-serif;background-color:#fff}:root{--accent: #00a3d2;--border-width:  5px }</style><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/css/copy-btn.css><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script src=/js/copy-btn.js></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-98056974-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-98056974-1');</script><script>window.MathJax={jax:["input/TeX","output/CommonHTML"],extensions:["tex2jax.js","asciimath2jax.js","mml2jax.js","MathMenu.js","MathZoom.js"],TeX:{extensions:["AMSmath.js","AMSsymbols.js","autoload-all.js"]},tex2jax:{inlineMath:[['$','$'],["\\(","\\)"]],processEscapes:true},showProcessingMessages:false,messageStyle:"none",menuSettings:{zoom:"Click"},AuthorInit:function(){MathJax.Hub.Register.StartupHook("End",function(){var timeout=false,delay=250;var shrinkMath=function(){var dispFormulas=document.getElementsByClassName("formula");if(dispFormulas){var contentTest=document.getElementsByTagName("body")[0];var nodesWidth=contentTest.offsetWidth;var mathIndent=MathJax.Hub.config.displayIndent;var mathIndentValue=mathIndent.substring(0,mathIndent.length-2);for(var i=0;i<dispFormulas.length;i++){var dispFormula=dispFormulas[i];var wrapper=dispFormula.getElementsByClassName("MathJax_Preview")[0].nextSibling;var child=wrapper.firstChild;wrapper.style.transformOrigin="center";var oldScale=child.style.transform;var newValue=Math.min(0.80*dispFormula.offsetWidth/child.offsetWidth,1.0).toFixed(2);var newScale="scale("+newValue+")";if(!(newScale===oldScale)){wrapper.style.transform=newScale;wrapper.style["margin-left"]=Math.pow(newValue,4)*mathIndentValue+"px";var wrapperStyle=window.getComputedStyle(wrapper);var wrapperHeight=parseFloat(wrapperStyle.height);wrapper.style.height=""+(wrapperHeight*newValue)+"px";if(newValue==="1.00"){wrapper.style.cursor="";wrapper.style.height="";}
else{wrapper.style.cursor="zoom-in";}}}}};shrinkMath();window.addEventListener('resize',function(){clearTimeout(timeout);timeout=setTimeout(shrinkMath,delay);});});}};(function(d,script){script=d.createElement('script');script.type='text/javascript';script.async=true;script.onload=function(){};script.src='https://cdn.mathjax.org/mathjax/latest/MathJax.js';d.getElementsByTagName('head')[0].appendChild(script);}(document));</script><meta name=google-site-verification content="g_3tJyj-KkW-_wKx7Ij5GimHV1nKPZXetCz8ydbBAfA"></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class=container><div class=navbar-header><a class="navbar-brand visible-xs" href=#>Sequelize</a>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href=/>Home</a></li><li><a href=/wiki/>Wiki</a></li><li><a href=/posts/>Posts</a></li><li><a href=/about/>About</a></li></ul><ul class="nav navbar-nav navbar-right"><li class=navbar-icon><a href=mailto:makerdark98@gmail.com><i class="fa fa-envelope-o"></i></a></li><li class=navbar-icon><a href=https://github.com/makerdark98/><i class="fa fa-github"></i></a></li><li><div style=max-width:250px;display:inline-block;max-height:40px><script async src="https://cse.google.com/cse.js?cx=003491619885022567520:wnnypdnx4aj"></script><div class=gcse-search></div></div></li></ul></div></div></nav><main><div class=navigator style=display:flex><div style=display:flex><a href=/wiki/><button class="btn btn-link"><i class="fa fa-arrow-left"></i>&nbsp;Front Page</button></a></div><div style=margin-left:auto><div style=display:flex><div style=margin-left:auto><div class=wiki-history></div></div></div><script src=/js/localhistory.js></script><script>var now="Sequelize"
pushHistory(now);</script></div></div><div><h2>Sequelize</h2><a href=https://github.com/makerdark98/makerdark98.github.io/blame/master/src/content/wiki/Sequelize.md><h5>created : Tue, 07 Apr 2020 20:31:57 +0900</h5><h5>modified : Wed, 08 Apr 2020 12:51:20 +0900</h5></a></div><aside class=navbar id=nav-toc style=text-align:left><nav id=TableOfContents><ul><li><a href=#setting-up-a-connection>Setting up a connection</a></li><li><a href=#note-connection-pool-production>Note: connection pool (production)</a></li><li><a href=#testing-the-connection>Testing the connection</a></li></ul><ul><li><a href=#data-retrieval--finders>Data retrieval / Finders</a><ul><li><a href=#find---search-for-one-specific-element-in-the-database>find - Search for one specific element in the database</a></li><li><a href=#findorcreate---search-for-a-specific-element-or-create-it-if-not-available>findOrCreate - Search for a specific element or create it if not available</a></li><li><a href=#findandcountall---search-for-multiple-elements-in-the-database-returns-both-data-and-total-count>findAndCountAll - Search for multiple elements in the database, returns both data and total count</a></li><li><a href=#findall---search-for-multiple-elements-in-the-database>findAll - Search for multiple elements in the database</a></li><li><a href=#complex-filtering--or--not-queries>Complex filtering / OR / NOT queries</a></li></ul></li></ul></nav></aside><div align=start class=content data-spy=scroll data-offset=20 data-target=#nav-toc style=position:relative><h1 id=-installation># Installation</h1><pre><code>npm install --save sequelize

# One of the following
npm install --save pg pg-hstore # Postgres
npm install -save mysql2 # mysql
npm install --save mariadb # mariadb
npm install --save sqlite3 # sqlite
npm install --save tedious # Microsoft SQL Server
</code></pre><h1 id=configuration-typescript>Configuration (Typescript)</h1><h2 id=setting-up-a-connection>Setting up a connection</h2><pre><code>import { Sequelize } from 'sequelize';

interface DBConfituration {
    database: string;
    user: string;
    password: string;
    host: string;
    dialect: &quot;mysql&quot; | &quot;postgres&quot; | &quot;sqlite&quot; | &quot;mariadb&quot; | &quot;msqle&quot; | undefined;
}

const dbConfiguration : DBConfiguration = {
    database: &quot;graph&quot;,
    user: &quot;graph&quot;,
    password: &quot;graph&quot;,
    host: &quot;localhost&quot;,
    dialect: &quot;mysql&quot;
};

const sequelize = new Sequelize(
    dbConfiguration.database,
    dbConfiguration.user,
    dbConfiguration.password,
    {
        host: dbConfiguration.host,
        dialect: dbConfgiguration.dialect,
    },
);

const sequelize = new Sequelize('postgres://user:pass@example.con:5432/dbname');
</code></pre><h2 id=note-connection-pool-production>Note: connection pool (production)</h2><pre><code>const sequelize = new Sequelize(/* ... */, {
    // ...
    pool: {
        max: 5,
        min: 0,
        acquire: 30000,
        idle: 10000,
    }
});
</code></pre><h2 id=testing-the-connection>Testing the connection</h2><pre><code>sequelize
    .authenticate()
    .then(() =&gt; {
        console.log('Connection has been established successfully.');
    })
    .catch(err =&gt; {
        console.error('Unable to connect to the database:', err);
});
</code></pre><ul><li>Sample Code (Typescript)</li></ul><h1 id=model-usage>Model usage</h1><h2 id=data-retrieval--finders>Data retrieval / Finders</h2><h3 id=find---search-for-one-specific-element-in-the-database>find - Search for one specific element in the database</h3><pre><code>// search for known ids
Project.findByPk(123).then(project =&gt; {
  // project will be an instance of Project and stores the content of the table entry
  // with id 123. if such an entry is not defined you will get null
})

// search for attributes
Project.findOne({ where: {title: 'aProject'} }).then(project =&gt; {
  // project will be the first entry of the Projects table with the title 'aProject' || null
})


Project.findOne({
  where: {title: 'aProject'},
  attributes: ['id', ['name', 'title']]
}).then(project =&gt; {
  // project will be the first entry of the Projects table with the title 'aProject' || null
  // project.get('title') will contain the name of the project
})
</code></pre><h3 id=findorcreate---search-for-a-specific-element-or-create-it-if-not-available>findOrCreate - Search for a specific element or create it if not available</h3><pre><code>User
  .findOrCreate({where: {username: 'sdepold'}, defaults: {job: 'Technical Lead JavaScript'}})
  .then(([user, created]) =&gt; {
    console.log(user.get({
      plain: true
    }))
    console.log(created)

    /*
     findOrCreate returns an array containing the object that was found or created and a boolean that
     will be true if a new object was created and false if not, like so:

    [ {
        username: 'sdepold',
        job: 'Technical Lead JavaScript',
        id: 1,
        createdAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET),
        updatedAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET)
      },
      true ]

 In the example above, the array spread on line 3 divides the array into its 2 parts and passes them
  as arguments to the callback function defined beginning at line 39, which treats them as &quot;user&quot; and
  &quot;created&quot; in this case. (So &quot;user&quot; will be the object from index 0 of the returned array and
  &quot;created&quot; will equal &quot;true&quot;.)
    */
  })

User.create({ username: 'fnord', job: 'omnomnom' })
  .then(() =&gt; User.findOrCreate({where: {username: 'fnord'}, defaults: {job: 'something else'}}))
  .then(([user, created]) =&gt; {
    console.log(user.get({
      plain: true
    }))
    console.log(created)

    /*
    In this example, findOrCreate returns an array like this:
    [ {
        username: 'fnord',
        job: 'omnomnom',
        id: 2,
        createdAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET),
        updatedAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET)
      },
      false
    ]
    The array returned by findOrCreate gets spread into its 2 parts by the array spread on line 3, and
    the parts will be passed as 2 arguments to the callback function beginning on line 69, which will
    then treat them as &quot;user&quot; and &quot;created&quot; in this case. (So &quot;user&quot; will be the object from index 0
    of the returned array and &quot;created&quot; will equal &quot;false&quot;.)
    */
  })
</code></pre><h3 id=findandcountall---search-for-multiple-elements-in-the-database-returns-both-data-and-total-count>findAndCountAll - Search for multiple elements in the database, returns both data and total count</h3><pre><code>Project
  .findAndCountAll({
     where: {
        title: {
          [Op.like]: 'foo%'
        }
     },
     offset: 10,
     limit: 2
  })
  .then(result =&gt; {
    console.log(result.count);
    console.log(result.rows);
  });

User.findAndCountAll({
  include: [
     { model: Profile, required: true }
  ],
  limit: 3
});

User.findAndCountAll({
  include: [
     { model: Profile, where: { active: true }}
  ],
  limit: 3
});
</code></pre><h3 id=findall---search-for-multiple-elements-in-the-database>findAll - Search for multiple elements in the database</h3><pre><code>// find multiple entries
Project.findAll().then(projects =&gt; {
  // projects will be an array of all Project instances
})

// search for specific attributes - hash usage
Project.findAll({ where: { name: 'A Project' } }).then(projects =&gt; {
  // projects will be an array of Project instances with the specified name
})

// search within a specific range
Project.findAll({ where: { id: [1,2,3] } }).then(projects =&gt; {
  // projects will be an array of Projects having the id 1, 2 or 3
  // this is actually doing an IN query
})

Project.findAll({
  where: {
    id: {
      [Op.and]: {a: 5},           // AND (a = 5)
      [Op.or]: [{a: 5}, {a: 6}],  // (a = 5 OR a = 6)
      [Op.gt]: 6,                // id &gt; 6
      [Op.gte]: 6,               // id &gt;= 6
      [Op.lt]: 10,               // id &lt; 10
      [Op.lte]: 10,              // id &lt;= 10
      [Op.ne]: 20,               // id != 20
      [Op.between]: [6, 10],     // BETWEEN 6 AND 10
      [Op.notBetween]: [11, 15], // NOT BETWEEN 11 AND 15
      [Op.in]: [1, 2],           // IN [1, 2]
      [Op.notIn]: [1, 2],        // NOT IN [1, 2]
      [Op.like]: '%hat',         // LIKE '%hat'
      [Op.notLike]: '%hat',       // NOT LIKE '%hat'
      [Op.iLike]: '%hat',         // ILIKE '%hat' (case insensitive)  (PG only)
      [Op.notILike]: '%hat',      // NOT ILIKE '%hat'  (PG only)
      [Op.overlap]: [1, 2],       // &amp;&amp; [1, 2] (PG array overlap operator)
      [Op.contains]: [1, 2],      // @&gt; [1, 2] (PG array contains operator)
      [Op.contained]: [1, 2],     // &lt;@ [1, 2] (PG array contained by operator)
      [Op.any]: [2,3]            // ANY ARRAY[2, 3]::INTEGER (PG only)
    },
    status: {
      [Op.not]: false           // status NOT FALSE
    }
  }
})
</code></pre><h3 id=complex-filtering--or--not-queries>Complex filtering / OR / NOT queries</h3><pre><code>Project.findOne({
  where: {
    name: 'a project',
    [Op.or]: [
      { id: [1,2,3] },
      { id: { [Op.gt]: 10 } }
    ]
  }
})

Project.findOne({
  where: {
    name: 'a project',
    id: {
      [Op.or]: [
        [1,2,3],
        { [Op.gt]: 10 }
      ]
    }
  }
})
</code></pre></div><script src=/js/wikilink.js></script><div><script src=https://utteranc.es/client.js repo=makerdark98/makerdark98.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></main><footer><p class="copyright text-muted">© All rights reserved. Powered by <a href=https://gohugo.io>Hugo</a> and <a href=https://github.com/calintat/minimal>Minimal</a>.</p></footer></body></html>