<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://unpkg.com/simpledotcss/simple.css><link rel=stylesheet href=/css/main.css><meta name=generator content="Hugo 0.140.0"><meta name=description content="minuk.dev wiki"><meta name=keywords content="hugo,site,new"><meta name=author content="Min-Uk.Lee"><title>Observability Engineering |
minuk dev wiki
</title><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script></head><body><header class=header><div class=header_left><a href=/><img class=logo src=/images/Rb.png alt=logo>
MinUk.Dev</a></div><div class=header_middle>Observability Engineering</div></header><main><article class=main><div class=title><h1 class=title-header>Observability Engineering</h1></div><a href=https://github.com/minuk-dev/minuk-dev.github.io/blame/master/content/wiki/observability-engineering.md><h5>created : Mon, 20 Feb 2023 22:40:32 +0900</h5><h5>modified : Fri, 05 May 2023 22:42:41 +0900</h5></a><div class=article-meta><div class="breadcumb content"><i class="bi bi-folder"></i>
[[Book Review]]</div></div><div class=list-terms><ul><i class="bi bi-tags" title=Tags></i></ul></div><aside class=navbar id=nav-toc style=text-align:left><nav id=TableOfContents><ul><li><a href=#chapter-1-what-is-observability>Chapter 1. What Is Observability?</a><ul><li><a href=#the-mathematical-definition-of-observability>The Mathematical Definition of Observability</a></li><li><a href=#applying-observability-to-software-systems>Applying Observability to Software Systems</a></li><li><a href=#why-observability-matters-now>Why Observability Matters Now</a></li><li><a href=#debugging-with-metrics-versus-observability>Debugging with Metrics Versus Observability</a></li><li><a href=#the-role-of-cardinality>The Role of Cardinality</a></li><li><a href=#the-role-of-dimensionality>The Role of Dimensionality</a></li></ul></li><li><a href=#debugging-with-observability>Debugging with Observability</a></li><li><a href=#observability-is-for-modern-systems>Observability Is for Modern Systems</a></li></ul><ul><li><a href=#how-monitoring-data-is-used-for-debugging>How Monitoring Data Is Used for Debugging</a><ul><li><a href=#troubleshooting-behaviors-when-using-dashboards>Troubleshooting Behaviors When Using Dashboards</a></li><li><a href=#how-observability-enables-better-debugging>How Observability Enables Better Debugging</a></li><li><a href=#conclusion>Conclusion</a></li></ul></li><li><a href=#chapter3-lessons-from-scaling-wihtout-observability>Chapter3. Lessons from Scaling Wihtout Observability</a><ul><li><a href=#the-evolution-toward-modern-practices>The Evolution Toward Modern Practices</a></li></ul></li><li><a href=#chapter-4-how-observability-relates-to-devops-sre-and-cloud-native>Chapter 4. How Observability Relates to DevOps, SRE, and Cloud Native</a><ul><li><a href=#cloud-native-devops-and-sre-in-a-nutshell>Cloud Native, DevOps, and SRE in a Nutshell</a></li><li><a href=#observability-deubbing-then-versus-now>Observability: Deubbing Then Versus Now</a></li><li><a href=#observability-empowers-devops-and-sre-practices>Observability Empowers DevOps and SRE Practices</a></li><li><a href=#conclusion-1>Conclusion</a></li></ul></li></ul><ul><li><a href=#chatper-5-structured-events-are-the-building-blocks-of-observability>Chatper 5. Structured Events Are the Building Blocks of Observability</a><ul><li><a href=#debugging-with-structured-events>Debugging with Structured Events</a></li><li><a href=#the-limitations-of-metrics-as-a-building-block>The Limitations of Metrics as a Building Block</a></li><li><a href=#the-limitations-of-traditional-logs-as-a-building-block>The Limitations of Traditional Logs as a Building Block</a></li><li><a href=#properties-of-events-that-are-useful-in-debugging>Properties of Events That Are Useful in Debugging</a></li><li><a href=#conclusion-2>Conclusion</a></li></ul></li><li><a href=#chapter-6-stitchign-events-into-traces>Chapter 6. Stitchign Events into Traces</a><ul><li><a href=#distributed-tracing-and-why-it-matters-now>Distributed Tracing and Why It Matters Now</a></li><li><a href=#the-components-of-tracing>The Components of Tracing</a></li><li><a href=#instrumenting-a-trace-the-hard-way>Instrumenting a Trace the Hard Way</a></li><li><a href=#adding-custom-fields-into-trace-spans>Adding Custom Fields into Trace Spans</a></li><li><a href=#stitching-events-into-traces>Stitching Events into Traces</a></li><li><a href=#conclusion-3>Conclusion</a></li></ul></li><li><a href=#chapter-7-instrumentation-with-opentelemetry>Chapter 7. Instrumentation with OpenTelemetry</a><ul><li><a href=#a-brief-introduction-to-instrumentation>A Brief Introduction to Instrumentation</a></li><li><a href=#open-instrumentation-standards>Open Instrumentation Standards</a></li><li><a href=#instrumentation-using-code-based-examples>Instrumentation Using Code-Based Examples</a></li><li><a href=#send-instrumentation-data-to-a-backend-system>Send Instrumentation Data to a Backend System</a></li><li><a href=#conclusion-4>Conclusion</a></li></ul></li><li><a href=#chapter-8-analyzing-events-to-achieve-observability>Chapter 8. Analyzing Events to Achieve Observability</a><ul><li><a href=#debugging-from-known-conditions>Debugging from Known Conditions</a></li><li><a href=#debugging-from-first-principles>Debugging from First Principles</a></li><li><a href=#using-the-core-analysis-loop>Using the Core Analysis Loop</a></li><li><a href=#automating-the-brute-force-portion-of-the-core-analysis-loop>Automating the Brute-Force Portion of the Core Analysis Loop</a></li><li><a href=#this-misleading-promise-of-aiops>This Misleading Promise of AIOps</a></li><li><a href=#conclusion-5>Conclusion</a></li></ul></li><li><a href=#chapter-9-how-observability-and-monitoring-come-together>Chapter 9. How Observability and Monitoring Come Together</a><ul><li><a href=#where-monitoring-fits>Where Monitoring Fits</a></li><li><a href=#where-observability-fits>Where Observability Fits</a></li><li><a href=#system-versus-software-considerations>System Versus Software Considerations</a></li><li><a href=#accessing-your-organizational-needs>Accessing Your Organizational Needs</a></li><li><a href=#conclusion-6>Conclusion</a></li></ul></li></ul><ul><li><a href=#chapter-10-applying-observability-practices-in-your-team>Chapter 10. Applying Observability Practices in Your Team</a><ul><li><a href=#join-a-community-group>Join a Community Group</a></li><li><a href=#start-with-the-biggest-pain-points>Start with the Biggest Pain Points</a></li><li><a href=#buy-instead-of-build>Buy Instead of Build</a></li><li><a href=#flesh-out-your-instrumentation-iteratively>Flesh Out Your Instrumentation Iteratively</a></li><li><a href=#look-for-opportunities-to-leverage-existing-efforts>Look for Opportunities to Leverage Existing Efforts</a></li><li><a href=#prepare-for-the-hardest-last-push>Prepare for the Hardest Last Push</a></li><li><a href=#conclusion-7>Conclusion</a></li></ul></li><li><a href=#chapter-11-observability-driven-development>Chapter 11. Observability-Driven Development</a><ul><li><a href=#test-driven-development>Test-Driven Development</a></li><li><a href=#observability-in-the-development-cycle>Observability in the Development Cycle</a></li><li><a href=#determining-where-to-debug>Determining Where to Debug</a></li><li><a href=#debugging-in-the-time-of-microservices>Debugging in the Time of Microservices</a></li><li><a href=#how-instrumentation-drives-observability>How Instrumentation Drives Observability</a></li><li><a href=#shifting-observability-left>Shifting Observability Left</a></li><li><a href=#using-observability-to-speed-up-software-delivery>Using Observability to Speed Up Software Delivery</a></li><li><a href=#conclusion-8>Conclusion</a></li></ul></li><li><a href=#chapter-12-using-service-level-objectives-for-reliability>Chapter 12. Using Service-Level Objectives for Reliability</a><ul><li><a href=#traditional-monitoring-approaches-create-dangerous-alert-fatigue>Traditional Monitoring Approaches Create Dangerous Alert Fatigue</a></li><li><a href=#threshold-alert-is-for-known-unknowns-only>Threshold Alert Is for Known-Unknowns Only</a></li><li><a href=#user-experience-is-a-north-star>User Experience Is a North Star</a></li></ul></li><li><a href=#what-is-a-service-level-objective>What Is a Service-Level Objective?</a><ul><li><a href=#reliable-alerting-with-slos>Reliable Alerting with SLOs</a></li><li><a href=#conclusion-9>Conclusion</a></li></ul></li><li><a href=#chatper-13-acting-on-and-debugging-slo-based-alerts>Chatper 13. Acting on and Debugging SLO-Based ALerts</a><ul><li><a href=#alerting-before-your-error-budget-is-empty>Alerting Before Your Error Budget Is Empty</a></li><li><a href=#framing-time-as-a-sliding-window>Framing Time as a Sliding Window</a></li><li><a href=#forecasting-to-create-a-predictive-burn-alert>Forecasting to Create a Predictive Burn Alert</a></li><li><a href=#using-observability-data-for-slos-versus-time-series-data>Using Observability Data for SLOs Versus Time-Series data</a></li><li><a href=#conclusion-10>Conclusion</a></li></ul></li><li><a href=#chapter-14-observability-and-the-software-supply-chain>Chapter 14. Observability and the Software Supply Chain</a></li></ul><ul><li><a href=#chatper-15-build-versus-buy-and-return-on-investment>Chatper 15. Build Versus Buy and Return on Investment</a><ul><li><a href=#how-to-anlyze-the-roi-of-observability>How to Anlyze the ROI of Observability</a></li><li><a href=#the-real-costs-of-building-your-own>The Real Costs of Building Your Own</a></li><li><a href=#the-real-costs-of-buying-software>The Real Costs of Buying Software</a></li><li><a href=#buy-versus-build-is-not-a-binary-choice>Buy Versus Build Is Not a Binary Choice</a></li></ul></li><li><a href=#chatper-16-efficient-data-storage>Chatper 16. Efficient Data Storage</a><ul><li><a href=#the-functional-requirements-for-observability>The Functional Requirements for Observability</a></li></ul></li><li><a href=#chapter-17-cheap-and-accurateenough-sampling>Chapter 17. Cheap and AccurateEnough: Sampling</a><ul><li><a href=#sampling-to-refine-your-data-collection>Sampling to Refine Your Data Collection</a></li><li><a href=#using-different-approaches-to-sampling>Using Different Approaches to Sampling</a></li><li><a href=#translating-sampling-strategies-into-code>Translating Sampling Strategies into Code</a></li></ul></li><li><a href=#chapter-18-telemetry-mangement-with-pipelines>Chapter 18. Telemetry Mangement with Pipelines</a><ul><li><a href=#attributes-of-telemetry-pipelines>Attributes of Telemetry Pipelines</a></li><li><a href=#managing-a-telemetry-pipeline-anatomy>Managing a Telemetry Pipeline: Anatomy</a></li><li><a href=#challenges-when-managing-a-telemetry-pipeline>Challenges When Managing a Telemetry Pipeline</a></li><li><a href=#use-case-telemetry-management-at-slack>Use Case: Telemetry Management at Slack</a></li><li><a href=#open-source-alternatives>Open Source Alternatives</a></li></ul></li></ul><ul><li><a href=#chapter-19-the-business-case-for-observability>Chapter 19. The business Case for Observability</a><ul><li><a href=#the-reactive-approach-to-introducing-change>The Reactive Approach to Introducing Change</a></li><li><a href=#the-return-on-investment-of-observability>The Return on Investment of Observability</a></li><li><a href=#the-proactive-approach-to-introducing-change>The Proactive Approach to Introducing Change</a></li><li><a href=#introducing-observability-as-a-practice>Introducing Observability as a Practice</a></li><li><a href=#using-the-approriate-tools>Using the Approriate Tools</a></li><li><a href=#knowing-when-you-have-enough-observability>Knowing When You Have Enough Observability</a></li><li><a href=#conclusion-11>Conclusion</a></li></ul></li><li><a href=#chapter-20-observabilitys-stakeholders-and-allies>Chapter 20. Observability&rsquo;s Stakeholders and Allies</a><ul><li><a href=#recognizing-nonengineering-observability-needs>Recognizing Nonengineering Observability Needs</a></li><li><a href=#creating-observability-allies-in-practice>Creating Observability Allies in Practice</a></li><li><a href=#using-observability-versus-business-intelligence-tools>Using Observability Versus Business Intelligence Tools</a></li></ul></li><li><a href=#chapter-21-an-observability-maturity-model>Chapter 21. An Observability Maturity Model</a><ul><li><a href=#a-note-about-maturity-models>A Note About Maturity Models</a></li><li><a href=#why-observability-needs-a-maturity-model>Why Observability Needs a Maturity Model</a></li><li><a href=#about-the-obserability-maturity-model>About the Obserability Maturity Model</a></li><li><a href=#capabilities-refernced-in-the-omm>Capabilities Refernced in the OMM</a></li><li><a href=#using-the-omm-for-your-organization>Using the OMM for Your Organization</a></li><li><a href=#conclusion-12>Conclusion</a></li></ul></li><li><a href=#chatper-22-where-to-go-from-here>Chatper 22. Where to Go from Here</a><ul><li><a href=#observability-then-versus-now>Observability, Then Versus Now</a></li><li><a href=#additional-resource>Additional Resource</a></li><li><a href=#predictions-for-where-observability-is-going>Predictions for Where Observability Is Going</a></li></ul></li></ul></nav></aside><div class=content><h1 id=part-i-the-path-to-observability>Part I. The Path to Observability</h1><h2 id=chapter-1-what-is-observability>Chapter 1. What Is Observability?</h2><h3 id=the-mathematical-definition-of-observability>The Mathematical Definition of Observability</h3><ul><li>Observability : a measure of how well internal states of a system can be inferred from knowledge of its external outputs.</li></ul><h3 id=applying-observability-to-software-systems>Applying Observability to Software Systems</h3><ul><li>Understand the inner workings of your application</li><li>Understand any stem state your application may have gotten itself into, even new ones you have never seen before and couldn&rsquo;t have predicted</li><li>Understand the innner workings and system state solely by observing and interrogating with external tools</li><li>Understand the internal state without shipping any new custom code to handle it (because that implies you needed prior knowledge to explain it)</li></ul><h3 id=why-observability-matters-now>Why Observability Matters Now</h3><ul><li>With monitoring, software developers can&rsquo;t fully see their systems. They squint at the systems.</li></ul><h4 id=is-this-really-the-best-way>Is This Really the Best Way?</h4><ul><li>As an industry, we generally don&rsquo;t question whether we should do it, but how.</li><li>More abstract and more complex system</li></ul><h4 id=why-are-metrics-and-monitoring-not-enough>Why Are Metrics and Monitoring Not Enough?</h4><ul><li>Traditional:<ul><li>Monolith</li><li>1 stateful (database)</li><li>low-level permission</li><li>controllable containers, VMs, bare metals</li><li>static, long-running</li><li>only can examine after problems occurred.</li><li>dashboard & telemetry serve for only ops engineers.</li><li>block-box applications</li><li>focus on uptime & failure prevention</li><li>limited or small number of dimensions</li></ul></li><li>But, now:<ul><li>many service</li><li>polyglot persistence</li><li>extremely dynamic infrastructure</li><li>many far-flung and loosely couped services</li><li>uncontrollable</li><li>not only ops engineers, but also others</li><li>automatic instrumentation for complex systems</li><li>focus on reliability & toleration</li><li>unlimited number of dimensions</li></ul></li></ul><h3 id=debugging-with-metrics-versus-observability>Debugging with Metrics Versus Observability</h3><ul><li>Debugging with metrics requires you to connect dozens of disconnected metrics that were recorded over the course of executing any one particular request, across any number of service or machines, to infer what might have occurred over the various hops needed for its fulfillment.</li><li>Monitoring is for the known-kunknowns, but observability is for the unknown-unknowns.</li></ul><h3 id=the-role-of-cardinality>The Role of Cardinality</h3><ul><li>Cardinality matters for observability, because high-cardinality information is almost always the most useful in identifying data for debugging or understanding a system.</li><li>Unfortunately, metrics-based tooling systems can deal with only low-cardinality dimensions at any reasonable scale.</li></ul><h3 id=the-role-of-dimensionality>The Role of Dimensionality</h3><ul><li>Cardinality: The uniqueness of the value within your data</li><li>Dimensionality: The number of keys within that data</li></ul><h2 id=debugging-with-observability>Debugging with Observability</h2><ul><li>Observability tools encourage developers to gather rich telemetry for every possible event that could occur, passing along the full context of any given request and storing it for possible use at some point down the line.</li><li>Observability tools are specifically designed to query aginst high-cardinality, high-dimensionality data.</li></ul><h2 id=observability-is-for-modern-systems>Observability Is for Modern Systems</h2><h1 id=chapter-2-how-debugging-practices-differ-between-observability-and-monitoring>Chapter 2. How Debugging Practices Differ Between Observability and Monitoring</h1><ul><li>Traditional monitoring:<ul><li>checking system conditions against known thresholds</li><li>reactive approach</li></ul></li><li>Observability tools:<ul><li>enabling iterative exploratory investigations</li><li>proactive approch to identifying any failure mode, whether known or unknown</li></ul></li></ul><h2 id=how-monitoring-data-is-used-for-debugging>How Monitoring Data Is Used for Debugging</h2><ul><li>Two main consumers of monitoring data:<ul><li>machine: alert</li><li>human: dashboard</li></ul></li></ul><h3 id=troubleshooting-behaviors-when-using-dashboards>Troubleshooting Behaviors When Using Dashboards</h3><ul><li>Seeing that pattern, you quickly pull up the dashboard for the caching component of your system to confirm your suspicion.</li></ul><h4 id=the-limitations-of-troubleshooting-by-intuition>The Limitations of Troubleshooting by Intuition</h4><ul><li><p>Example 1: Insufficient correlation:</p><ul><li>Is a particular query scanning fewer rows than before?</li><li>How often is the new index getting chosen by the query planner, and for which queries?</li><li>Are write latencies up overall, on average, or at the 95th/99th percentiles?</li><li>Are queries fatser or slower when they use this index than their previous query plan?</li><li>What other indexes are also used along with the new index?</li><li>Has this index made any other indexes obsolete, so we can drop those and reclaim some write capacity?</li></ul></li><li><p>The engineers in the preceding examples might go back and add custom metrics for each query family, for expiration rates per collection, for error rates per shards, etc.</p></li></ul><h4 id=traditional-monitoring-is-fundamentally-reactive>Traditional Monitoring Is Fundamentally Reactive</h4><h3 id=how-observability-enables-better-debugging>How Observability Enables Better Debugging</h3><ul><li>Observability lets you explicitly discover the source of any problem, along any dimension or combination of dimensions, without needing to first predict where and how that problem might be happening; this model centers around questioning and understanding.</li><li>Differences:<ul><li>Relying on institutional knowledge</li><li>Finding Hidden Issues</li><li>Having confidence in diagnosing production issues</li></ul></li><li>Observability tools pull high-cardinality, high-dimensionality context from telemetry data into a signle location where investigators can easily slice and dice to zoom in, zoom out, or follow breadcrumbs to find definitive answers.</li></ul><h3 id=conclusion>Conclusion</h3><ul><li>Monitoring-based debugging:<ul><li>Metics & dashboard</li></ul></li><li>Observability-based debugging:<ul><li>Withouth learning on experience or intimate system knowledge to generate a hunch</li></ul></li></ul><h2 id=chapter3-lessons-from-scaling-wihtout-observability>Chapter3. Lessons from Scaling Wihtout Observability</h2><ul><li><code>If you can solve your problem with a LAMP stack (or equivalent), you probably should</code>:<ul><li>When architecting a service, the first rule is to not add unnecessary complexity.</li><li>Don&rsquo;t confuse boring with bad.</li></ul></li><li>On a technical level, thse shifts include several primary effects:<ul><li>The decomposition of everything, from one to many</li><li>The need for a variety of data stores, from one database to many storage systems</li><li>A migration from monolithic applications toward many smaller microservices</li><li>A variety of infrastructure types away from &ldquo;big iron&rdquo; servers toward contatiners, functions, serverless, and other ephemeral, elastic resources</li></ul></li></ul><h3 id=the-evolution-toward-modern-practices>The Evolution Toward Modern Practices</h3><ul><li><p>Userexperience can no longer be generalized as being the same for all service users. In the new model, different users of a service may be routed through the system in different ways, using different components, providing experience s that can vary widely.</p></li><li><p>Monitoring alerts that look for edge cases in production that have system conditions exceeding known thresholds generate a tremendous number of false positives, false negatives, and meaningless noise. Alerting has shifted to a model in which fewer alerts are triggered, by focusing only on symptoms that directly impact user experience.</p></li><li><p>Debuggers can no longer be attached to one specific runtime. Fullfilling service requests now requires hopping across a network, spanning multiple runtimes, often multiple times per individual request.</p></li><li><p>Known recurring failures that require manual remediation and can be defined in a runbook are no longer the norm. Service failures have shifted from that model toward one in which known recurring fialures can be recovered automatically. Failures that cannot be automatcially recovered, and therefore trigger an alert, likely mean the responding engineer wil lbe facing a novel problem.</p></li><li><p>Tips to diagnose problems:</p><ul><li>Microservices and requests that spanned multiple runtimes.</li><li>Polyglot storage systems, without requiring expertise in each.</li><li>Multitenancy and running obht server-side code and queries; we could easily drill down into individual user experiences to see exactly what was happening.</li></ul></li></ul><h2 id=chapter-4-how-observability-relates-to-devops-sre-and-cloud-native>Chapter 4. How Observability Relates to DevOps, SRE, and Cloud Native</h2><h3 id=cloud-native-devops-and-sre-in-a-nutshell>Cloud Native, DevOps, and SRE in a Nutshell</h3><ul><li>Loose coupling unlocks several key bueniness benefits</li><li>CNCF defines:<ul><li>cloud native: building and running scalable applications in modern, dynamic environments&mldr;</li><li>resilient, manageable, and observable.</li><li>make high-impact changes frequently and predictably with minimal toil</li></ul></li></ul><h3 id=observability-deubbing-then-versus-now>Observability: Deubbing Then Versus Now</h3><ul><li>Goal: agnostic in terms of how it&rsquo;s accomplished.</li><li>Immutable infrastructure means that it&rsquo;s no longer feasible to ssh into a host for debugging.</li></ul><h3 id=observability-empowers-devops-and-sre-practices>Observability Empowers DevOps and SRE Practices</h3><ul><li>Chaos engineering and continuous verification</li><li>Feature flagging</li><li>Progressive release patterns</li><li>Incident analysis and blameless postmortem</li></ul><h3 id=conclusion-1>Conclusion</h3><ul><li>The shift toward DevOps, SRE, and cloud native practices have created a need for a solution like observability.</li></ul><h1 id=part-ii-fundamentals-of-observability>Part II. Fundamentals of Observability</h1><h2 id=chatper-5-structured-events-are-the-building-blocks-of-observability>Chatper 5. Structured Events Are the Building Blocks of Observability</h2><ul><li>Metrics do not retain the context of the event, simply an aggregate measurement of what occurred at a particular time.</li></ul><h3 id=debugging-with-structured-events>Debugging with Structured Events</h3><ul><li>event : a record of everything that occurred while one particular request interacted with your service.</li><li>Details:<ul><li>unique IDs, variable values, headers, every parameter passed by the request, the execution time, any calls made to remote services, the execution time of those remote calls, or any other bit of context</li><li>key value pairs</li></ul></li><li>Arbitariliy wide events</li></ul><h3 id=the-limitations-of-metrics-as-a-building-block>The Limitations of Metrics as a Building Block</h3><ul><li>pre-aggregated measure</li><li>As aggregate numerical representations of predefined relations over predefined periods of time</li></ul><h3 id=the-limitations-of-traditional-logs-as-a-building-block>The Limitations of Traditional Logs as a Building Block</h3><h4 id=unstructured-logs>Unstructured Logs</h4><ul><li>Traditional logs are unstructured</li><li>hug volumes of noisy data : slow & clunky</li><li>Hard to handle in nowadays systems.</li></ul><h4 id=structured-logs>Structured Logs</h4><ul><li>Many logs are only portions of events</li><li>Dozon log lines</li><li>Log data can be useful when redesigned to resemble a structured event.</li></ul><h3 id=properties-of-events-that-are-useful-in-debugging>Properties of Events That Are Useful in Debugging</h3><ul><li>unknown-unknowns</li><li>An observability tool must be able to support high-cardinality queries to be useful to an investigator.</li><li>High cardinality and high dimensionality are the capabilities that enable you to find very fine-grained needles in deeply complex distributed system haystacks</li></ul><h3 id=conclusion-2>Conclusion</h3><ul><li>The fundamental building block of observability is the arbitrarily wide structured event.</li><li>Metrics aggregate system state over a predefined period of time.</li><li>Unstructured logs are human redable but computationally difficult to use.</li><li>Structured logs are machine parsable and can be useful for the goals of observability.</li></ul><h2 id=chapter-6-stitchign-events-into-traces>Chapter 6. Stitchign Events into Traces</h2><ul><li>Distributed traces are simply an interrelated series of events.</li></ul><h3 id=distributed-tracing-and-why-it-matters-now>Distributed Tracing and Why It Matters Now</h3><ul><li>Distirbuted tracing is a method of tracking the progression of a single request as it is handled by various services that make up an application.</li><li>Solution<ul><li>Twitter&rsquo;s Zipkin (2012)</li><li>Uber&rsquo;s Jaeger (2017)</li><li>Honycomb, Lightstep</li></ul></li></ul><h3 id=the-components-of-tracing>The Components of Tracing</h3><ul><li>TraceID: unique identifier</li><li>SpanID: unique identifier for each individual span created.</li><li>ParentID: A Parent ID is absent in the root span.</li><li>Timestamp: Each span must indicate when its work began</li><li>Duration: Each span must also record how long that work took to finish.</li></ul><h3 id=instrumenting-a-trace-the-hard-way>Instrumenting a Trace the Hard Way</h3><ul><li>traceID: UUID</li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=#ZgotmplZ>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>rootHandler</span>(<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>, <span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>traceData</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#a6e22e>any</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>traceData</span>[<span style=color:#e6db74>&#34;trace_id&#34;</span>] = <span style=color:#a6e22e>uuid</span>.<span style=color:#a6e22e>String</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>traceData</span>[<span style=color:#e6db74>&#34;span_id&#34;</span>] = <span style=color:#a6e22e>uuid</span>.<span style=color:#a6e22e>String</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>startTime</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>traceData</span>[<span style=color:#e6db74>&#34;timestamp&#34;</span>] = <span style=color:#a6e22e>startTime</span>.<span style=color:#a6e22e>Unix</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>authorized</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>callAuthService</span>(<span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>call</span> <span style=color:#a6e22e>NameService</span>(<span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>authorized</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>`{&#34;message&#34;: &#34;Waddup %s&#34;}`</span>, <span style=color:#a6e22e>name</span>)))
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>`{&#34;message&#34;: &#34;Not cool dawg&#34;}`</span>))
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>traceData</span>[<span style=color:#e6db74>&#34;duration_ms&#34;</span>] = <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Sub</span>(<span style=color:#a6e22e>startTime</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sendSpan</span>(<span style=color:#a6e22e>traceData</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><ul><li><a href=https://www.w3.org/TR/trace-context/>W3C</a></li><li>X-B3-TraceId: Contains the trace ID for the entire trace</li><li>X-B3-ParentSpanId: Contains the current span ID, which will be set as the parent ID in the child&rsquo;s generated span</li></ul><h3 id=adding-custom-fields-into-trace-spans>Adding Custom Fields into Trace Spans</h3><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=#ZgotmplZ>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>rootHandler</span>(<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>, <span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>traceData</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#a6e22e>any</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>traceData</span>[<span style=color:#e6db74>&#34;tags&#34;</span>] = make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#a6e22e>any</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>hostname</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Hostname</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>traceData</span>[<span style=color:#e6db74>&#34;tags&#34;</span>][<span style=color:#e6db74>&#34;hostname&#34;</span>] = <span style=color:#a6e22e>hostname</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}</span></span></code></pre></div></div><h3 id=stitching-events-into-traces>Stitching Events into Traces</h3><ul><li>Tracing doesn&rsquo;t have to be limited to service-to-service calls.</li></ul><h3 id=conclusion-3>Conclusion</h3><ul><li>Events are the building blocks of observability, and traces are simply an interrelated series of events.</li></ul><h2 id=chapter-7-instrumentation-with-opentelemetry>Chapter 7. Instrumentation with OpenTelemetry</h2><ul><li>OpenTelemetry standard</li></ul><h3 id=a-brief-introduction-to-instrumentation>A Brief Introduction to Instrumentation</h3><ul><li>Before otel, we may have installed instrumentation libraries or agents in our applications</li></ul><h3 id=open-instrumentation-standards>Open Instrumentation Standards</h3><ul><li>OpenTelemetry(OTel) : OpenTracing + OpenCensus</li><li>OTel has become the single open source standard for application instrumentation among observability solutions.</li></ul><h3 id=instrumentation-using-code-based-examples>Instrumentation Using Code-Based Examples</h3><ul><li>OpenTelemetry:<ul><li>API</li><li>SDK</li><li>Tracer</li><li>Meter</li><li>Context propagation</li><li>Exporter</li><li>Collector</li></ul></li></ul><h4 id=start-with-automatic-instrumentation>Start with Automatic Instrumentation</h4><ul><li><p>go:</p><ul><li><p>http</p><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=import%20%22go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp%22%0a%0amux.Handle%28%22/rout%22,%20otelhttp.NewHandler%28otelhttp.WithRoutTag%28%22/route%22,%20http.HandlerFunc%28h%29%29,%20%22handler_span_name%22%29%29>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mux</span>.<span style=color:#a6e22e>Handle</span>(<span style=color:#e6db74>&#34;/rout&#34;</span>, <span style=color:#a6e22e>otelhttp</span>.<span style=color:#a6e22e>NewHandler</span>(<span style=color:#a6e22e>otelhttp</span>.<span style=color:#a6e22e>WithRoutTag</span>(<span style=color:#e6db74>&#34;/route&#34;</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandlerFunc</span>(<span style=color:#a6e22e>h</span>)), <span style=color:#e6db74>&#34;handler_span_name&#34;</span>))</span></span></code></pre></div></div></li><li><p>gprc</p><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data="import%20%28%0a%20%20%22go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgprc%22%0a%29%0a%0as%20:=%20grpc.NewServer%28%0a%20%20grpc.UnaryInterceptor%28otelgrpc.UnaryServerInterceptor%28%29%29,%0a%20%20gprc.StreamInterceptor%28otelgrpc.StreamServerInterceptor%28%29%29,%0a%29">
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgprc&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>NewServer</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>UnaryInterceptor</span>(<span style=color:#a6e22e>otelgrpc</span>.<span style=color:#a6e22e>UnaryServerInterceptor</span>()),
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gprc</span>.<span style=color:#a6e22e>StreamInterceptor</span>(<span style=color:#a6e22e>otelgrpc</span>.<span style=color:#a6e22e>StreamServerInterceptor</span>()),
</span></span><span style=display:flex><span>)</span></span></code></pre></div></div></li></ul></li><li><p>java:</p><ul><li><p><a href=https://github.com/spring-cloud/spring-cloud-openfeign/commit/e745dd0c7cc84c916765337761edc7a92ad00e60>openfeign micrometer - related commit</a></p></li><li><p><a href=https://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/#micrometer-support>open feign docs</a></p></li><li><p><code>spring.cloud.openfeign.micrometer.enabled=true</code></p></li><li><p><code>spring.cloud.openfeign.client.config.feignName.micrometer.enabled=true</code></p></li><li><p>create <code>MicrometerObservationCapability</code> using <code>ObservationRegistry</code> Bean</p></li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=@Configuration%0apublic%20class%20ObservationConfiguration%20%7b%0a%20%20@Bean%0a%20%20public%20MicrometerObservationCapability%20micrometerObservationCapability%28ObservationRegistry%20registry%29%20%7b%0a%20%20%20%20%20%20return%20new%20MicrometerObservationCapability%28registry%29;%0a%20%20%7d%0a%7d>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ObservationConfiguration</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> MicrometerObservationCapability <span style=color:#a6e22e>micrometerObservationCapability</span>(ObservationRegistry registry) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> MicrometerObservationCapability(registry);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></li></ul><h4 id=add-custom-instrumentation>Add Custom Instrumentation</h4><ul><li>Starting and finishing trace spans</li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data="import%20%22go.opentelemetry.io/otel%22%0a%0avar%20tr%20=%20otel.Tracer%28%22module_name%22%29%0a%0afunc%20funcName%28ctx%20context.Context%29%20%7b%0a%20%20sp%20:=%20tr.Start%28ctx,%20%22span_name%22%29%0a%20%20defer%20sp.End%28%29%0a%0a%20%20//%20do%20work%20here%0a%7d">
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;go.opentelemetry.io/otel&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tr</span> = <span style=color:#a6e22e>otel</span>.<span style=color:#a6e22e>Tracer</span>(<span style=color:#e6db74>&#34;module_name&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>funcName</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sp</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tr</span>.<span style=color:#a6e22e>Start</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#e6db74>&#34;span_name&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>sp</span>.<span style=color:#a6e22e>End</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// do work here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}</span></span></code></pre></div></div><ul><li>Adding wide fields to an event</li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=import%20%22go.opentelemetry.io/otel/attribute%22%0a%0asp.SetAttributes%28attribute.Int%28%22http.code%22,%20resp.ResponseCode%29%29%0asp.SetAttributes%28attribute.String%28%22app.user%22,%20username%29%29>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;go.opentelemetry.io/otel/attribute&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sp</span>.<span style=color:#a6e22e>SetAttributes</span>(<span style=color:#a6e22e>attribute</span>.<span style=color:#a6e22e>Int</span>(<span style=color:#e6db74>&#34;http.code&#34;</span>, <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>ResponseCode</span>))
</span></span><span style=display:flex><span><span style=color:#a6e22e>sp</span>.<span style=color:#a6e22e>SetAttributes</span>(<span style=color:#a6e22e>attribute</span>.<span style=color:#a6e22e>String</span>(<span style=color:#e6db74>&#34;app.user&#34;</span>, <span style=color:#a6e22e>username</span>))</span></span></code></pre></div></div><h3 id=send-instrumentation-data-to-a-backend-system>Send Instrumentation Data to a Backend System</h3><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data="import%20%28%0a%20%20x%20%22github.com/my/backend/exporter%22%0a%20%20%22go.opentelemetry.io/otel%22%0a%20%20sdktrace%20%22go.opentelemetry.io/otel/sdk/trace%22%0a%29%0a%0afunc%20main%28%29%20%7b%0a%20%20exporterX%20:=%20x.NewExporter%28...%29%0a%20%20exporterY%20:=%20y.NewExporter%28...%29%0a%20%20tp,%20err%20:=%20sdktrace.NewTracerProvider%28%0a%20%20%20%20sdktrace.WithSampler%28sdktrace.AlwaysSample%28%29%29,%0a%20%20%20%20sdktrace.WithSyncer%28exporterX%29,%0a%20%20%20%20sdktrace.WithBatcher%28exporterY%29,%0a%20%20%29%0a%20%20otel.SetTracerProvider%28tp%29%0a%7d">
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>x</span> <span style=color:#e6db74>&#34;github.com/my/backend/exporter&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;go.opentelemetry.io/otel&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sdktrace</span> <span style=color:#e6db74>&#34;go.opentelemetry.io/otel/sdk/trace&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>exporterX</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>x</span>.<span style=color:#a6e22e>NewExporter</span>(<span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>exporterY</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>y</span>.<span style=color:#a6e22e>NewExporter</span>(<span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tp</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>sdktrace</span>.<span style=color:#a6e22e>NewTracerProvider</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sdktrace</span>.<span style=color:#a6e22e>WithSampler</span>(<span style=color:#a6e22e>sdktrace</span>.<span style=color:#a6e22e>AlwaysSample</span>()),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sdktrace</span>.<span style=color:#a6e22e>WithSyncer</span>(<span style=color:#a6e22e>exporterX</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sdktrace</span>.<span style=color:#a6e22e>WithBatcher</span>(<span style=color:#a6e22e>exporterY</span>),
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>otel</span>.<span style=color:#a6e22e>SetTracerProvider</span>(<span style=color:#a6e22e>tp</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><h3 id=conclusion-4>Conclusion</h3><ul><li>OTel is an open source standard.</li></ul><h2 id=chapter-8-analyzing-events-to-achieve-observability>Chapter 8. Analyzing Events to Achieve Observability</h2><ul><li>Hypothesis-driven debugging: form hypotheses and explorer the data to confirm or deny them. replying on intuition and pattern matching.</li></ul><h3 id=debugging-from-known-conditions>Debugging from Known Conditions</h3><ul><li><p>Prepare runbook to identify and solve evry possible &ldquo;root cause&rdquo;</p></li><li><p>Modern systems rarely fail in precisely the same way twice.:</p><ul><li>The time for creating runbooks & dashboards is largely wasted</li><li>Technical debt</li><li>Wrong documentation is perhaps more dangerous than no documentation</li></ul></li><li><p>Be debugging from known conditions, is not collection event data for unknown conditions.:</p><ul><li>e.g. <code>tail -f</code> and <code>grep</code> with unstructured logs, or finding a spike on one dashboard</li></ul></li></ul><h3 id=debugging-from-first-principles>Debugging from First Principles</h3><ul><li>The real power of observability is that you shouldn&rsquo;t have to know so much in advance of debugging an issue.</li></ul><h3 id=using-the-core-analysis-loop>Using the Core Analysis Loop</h3><ul><li>Four stages of the core analysis loop:<ul><li>What are you trying to understand?</li><li>Visualize telemetry data to find relevant performance anomalies</li><li>Search for common dimensions within the anomalous area by grouping of filtering for different attributes in your wide events</li><li>Has this isolated likely dimensions that identify potential sources of the anomaly?</li></ul></li></ul><h3 id=automating-the-brute-force-portion-of-the-core-analysis-loop>Automating the Brute-Force Portion of the Core Analysis Loop</h3><ul><li>The core analysis loop is a method to objectively find a signal that matters within a sea of otherwise normal system noise.</li></ul><h3 id=this-misleading-promise-of-aiops>This Misleading Promise of AIOps</h3><ul><li>artificial intelligence for operations (AIOps)</li></ul><h3 id=conclusion-5>Conclusion</h3><ul><li>The core analysis loop is an effective technique for fast fault localization.</li></ul><h2 id=chapter-9-how-observability-and-monitoring-come-together>Chapter 9. How Observability and Monitoring Come Together</h2><h3 id=where-monitoring-fits>Where Monitoring Fits</h3><ul><li>RRDs(round-robin databases) to TSDB(time series databases)</li><li>The optimization of monitoring systems to find known-unknowns means that it&rsquo;s a best fit for understanding the state of your systems, which change much less frequently and in more predictable ways than your application code.</li><li>Over time, metrics have also been adapted to creep into monitoring application-level concerns.:<ul><li>In the role of a warning signal, aggregate measures like metrics work well.</li></ul></li></ul><h3 id=where-observability-fits>Where Observability Fits</h3><ul><li>The optimization of observability to find unknown-unknowns means it&rsquo;s a best fit for understanding the state of the code you write, which changes much more frequently than your systems (typically, every day) and in far less predictable ways.</li><li>Monitoring and observabitliy tools have different best practices and different implementations, and they serve different purposes.</li></ul><h3 id=system-versus-software-considerations>System Versus Software Considerations</h3><ul><li><p>Software: the code you are actively developing that runs a production service delivering value to your customers.</p></li><li><p>System: an umbrella for everything else about the underlying infrastructure and runtime that is necessary to run that service.:</p><ul><li>databases(e.g., MySQL or MongoDB)</li><li>compute and storage (e.g. containers or virtual machines)</li><li>others (kafka, Postfix, HAProxy, Memcached, or even something like Jira)</li></ul></li><li><p>Factors that vary between systems and software</p></li></ul><p>| Factor | Your systems | Your software |
| Rate of change | Package updates (monthly) | Repo commits (daily) |
| Predictability | High (stable) | Low (many new features) |
| Value to your business | Low (cost center) | High (revenue generator) |
| Number of users | Few (internal teams) | Many (your customers) |
| Core concern | Is the system or service healthy? | Can each request acquire the resources it needs for end-to-end execution in a timely and reliable manner? |
| Evaluation perspective | The system | Your customers |
| Evaluation criteria | Low-level kernel and hardware device drivers | Variables and API endpoint |
| Functional responsibility | Infrastructure operations | Software development |
| Method for understanding | Monitoring | Observability |</p><h3 id=accessing-your-organizational-needs>Accessing Your Organizational Needs</h3><ul><li>Observability will help you deeply understand how software you develop and ship is performing when serving your customers.</li><li>Metrics-based monitoring tools and their associated alerts help you see when capacity limits or known error conditions of underlying systems are being reached.:<ul><li>low level DNS counters, disk statistics, ethernet ports, statistics, system firmware, etc.</li></ul></li><li>Today, your mileage may vary, depending on the robustness of your cloud provider.</li></ul><h4 id=exceptions-infrastructure-monitoring-that-cant-be-ignored>Exceptions: Infrastructure Monitoring That Can&rsquo;t Be Ignored.</h4><ul><li>higher-order infrastructure metircs like CPU usage, memory consumption, and disk activity are indicative of physical performance limitations.</li></ul><h4 id=real-world-examples>Real-World Examples</h4><ul><li>skip to summarize</li></ul><h3 id=conclusion-6>Conclusion</h3><ul><li>Monitoring is best suited to evaluating the health of your systems.</li><li>The most notable exceptions to that neat dividing line are higher-order infrastructure metrics on physical devices that directly impact software performance.</li></ul><h1 id=part-iii-observability-for-teams>Part III. Observability for Teams</h1><h2 id=chapter-10-applying-observability-practices-in-your-team>Chapter 10. Applying Observability Practices in Your Team</h2><h3 id=join-a-community-group>Join a Community Group</h3><ul><li>Technical Advisory Group (TAG) for Observability: <a href=https://github.com/cncf/tag-observability>https://github.com/cncf/tag-observability</a></li></ul><h3 id=start-with-the-biggest-pain-points>Start with the Biggest Pain Points</h3><ul><li>The fastest way to drive adoption is to solve the biggest pain points for teams responsible for managing their production services. Target those pains. Resist the urge to start small.</li></ul><h3 id=buy-instead-of-build>Buy Instead of Build</h3><ul><li>ROI</li><li>Your best way to do that is to instrument your applications by using OpenTelemetry.</li><li>ELK stack (Elasticsearch, Logstash, and Kibana)</li><li>Prometheus</li><li>Jaeger</li></ul><h3 id=flesh-out-your-instrumentation-iteratively>Flesh Out Your Instrumentation Iteratively</h3><ul><li>You don&rsquo;t need a fully developed set of instrumentation to get immediate value with observability</li></ul><h3 id=look-for-opportunities-to-leverage-existing-efforts>Look for Opportunities to Leverage Existing Efforts</h3><ul><li>Individuals and organizations commit the sunk-cost fallacy when they continue a behavior or endeavor as a result of previously invested time, money, or effort.</li><li>Examples:<ul><li>If you&rsquo;re using an ELK stack - or even just the Logstash part - it&rsquo;s trivial to add a snippet of code to fork the output of a source stream to your observability tool.</li><li>If you&rsquo;re already using structured logs, all you need to do is add a unique ID to log events as they propagate throughout your entire stack. You can keep those logs in your existing log analysis tool, while also sending them as trace events to your observability tool.</li><li>Try running observability instrumentation (for example, Honeycomb&rsquo;s Beelines or OTel) alongside your existing APM solution.</li><li>If you&rsquo;re using Ganglia, you can leverage that data by parsing the Extensible Markup Language (XML) dump it puts into <code>/var/tmp</code> with a once-a-minute cronjob that that shovels that data into your observability tool as events. That&rsquo;s a less than optimal use of observabilty, but it certainly creates familiarity for Ganglia users.</li><li>Re-create the most useful of your old monitoring dashbaords as easily referenceable queries within your new observability tool. While dashbaords certainly have their shortcomings, this gives new users a landing spot where they can understand the system performance they care about at glance, and also gives them an opportunity to explore and know more.</li></ul></li></ul><h3 id=prepare-for-the-hardest-last-push>Prepare for the Hardest Last Push</h3><ul><li>The goal of a complete implementation is to have built a reliable go-to debugging solution that can be used to fully understand the state of your production applications whenever anything goest wrong.</li></ul><h3 id=conclusion-7>Conclusion</h3><ul><li>moving fast, demonstrating high value and ROI, and tackling work iteratively.</li></ul><h2 id=chapter-11-observability-driven-development>Chapter 11. Observability-Driven Development</h2><h3 id=test-driven-development>Test-Driven Development</h3><ul><li>TDD is particularly powerful because tests run the same way every time.</li><li>Observability can help you write and ship better code even before it lands in source control</li></ul><h3 id=observability-in-the-development-cycle>Observability in the Development Cycle</h3><ul><li>While the original intent is still fresh in the original author&rsquo;s head.</li></ul><h3 id=determining-where-to-debug>Determining Where to Debug</h3><ul><li>Observability is not for debugging your code logic.</li><li>Observability is for figuring out where in your systems to find the code you need to debug.</li></ul><h3 id=debugging-in-the-time-of-microservices>Debugging in the Time of Microservices</h3><ul><li>It is likely still incredibly unclear according to your monitoring tooling whether that slowness is being caused by any of the collowing:<ul><li>A bug in your code</li><li>A particular user chaning their usage pattern</li><li>A database overflowing its capacity</li><li>Network connection limits</li><li>A misconfigured load balancer</li><li>Issues with service registration or service discovery</li><li>Some combination of the preceding factors</li></ul></li></ul><h3 id=how-instrumentation-drives-observability>How Instrumentation Drives Observability</h3><ul><li>Good instrumentation drives observability.</li><li>Every engineer should be expected to instrument their code such that they can answer these questions as soon as it&rsquo;s deployed:<ul><li>Is your code doing what your expected it to do?</li><li>How does it compare to the previous version?</li><li>Are users actively using your code?</li><li>Are any abnormal condtions emerging?</li></ul></li></ul><h3 id=shifting-observability-left>Shifting Observability Left</h3><ul><li>observability-driven development</li></ul><h3 id=using-observability-to-speed-up-software-delivery>Using Observability to Speed Up Software Delivery</h3><ul><li>Observability-driven development in tandem with feature flags and progressive delivery patterns can equip engineering teams with the tools they need to stop instinctively rolling back deployments and instead dig in to further investigate what&rsquo;s really happening whenever issues occur during relase of a new feature.</li></ul><h3 id=conclusion-8>Conclusion</h3><ul><li>Observability can, and should, be used early in the software development life cycel.</li><li>Test-driven development is a useful tool for examining how your code runs against a defined specification.</li><li>Observability-driven development is a useful tool for examining how your code behaves in the chaotic and turbulent world of production.</li></ul><h2 id=chapter-12-using-service-level-objectives-for-reliability>Chapter 12. Using Service-Level Objectives for Reliability</h2><h3 id=traditional-monitoring-approaches-create-dangerous-alert-fatigue>Traditional Monitoring Approaches Create Dangerous Alert Fatigue</h3><ul><li>Problem: normalization of deviance</li><li>alert fatigue</li><li>Distributed systems today require an alternative approach.</li></ul><h3 id=threshold-alert-is-for-known-unknowns-only>Threshold Alert Is for Known-Unknowns Only</h3><ul><li>failure is inevitable.</li><li>Distributed systems design for resilience with loosely coupled components.</li><li>Failures that get automatically remediated should not trigger alarms.</li><li>Alerting criteria:<ul><li>reliable indicator with service&rsquo;s UX</li><li>alert must be solvable</li></ul></li></ul><h3 id=user-experience-is-a-north-star>User Experience Is a North Star</h3><ul><li>Static thresholds are too rigid and coarse to reliably indicate degreaded user experience in a dynamic environment.</li></ul><h2 id=what-is-a-service-level-objective>What Is a Service-Level Objective?</h2><ul><li>Service-level objectives(SLOs)</li></ul><h3 id=reliable-alerting-with-slos>Reliable Alerting with SLOs</h3><ul><li>Two kinds of SLIs exist:<ul><li>time-based measures</li><li>event-based measures: must be actionable</li></ul></li></ul><h3 id=conclusion-9>Conclusion</h3><ul><li>SLOs decouple the &ldquo;what&rdquo; and &ldquo;why&rdquo; behind incident alerting. Focusing on symptom-of-pain-based alerts means that SLOs can be reliable indicators of customer experience.</li></ul><h2 id=chatper-13-acting-on-and-debugging-slo-based-alerts>Chatper 13. Acting on and Debugging SLO-Based ALerts</h2><h3 id=alerting-before-your-error-budget-is-empty>Alerting Before Your Error Budget Is Empty</h3><ul><li>error budge: maximum amount of system unavailability that your business is willing to tolerate</li></ul><h3 id=framing-time-as-a-sliding-window>Framing Time as a Sliding Window</h3><ul><li>The correct first choice to make when calculating burn trajectories is to frame time as a sliding window, rather than a statci fixed window.</li><li>Otherwise, there isn&rsquo;t enough data after a window reset to make meaningful decisions</li></ul><h3 id=forecasting-to-create-a-predictive-burn-alert>Forecasting to Create a Predictive Burn Alert</h3><ul><li>The Lookahead Window</li><li>Extrapolating the future from current burn rate</li><li>Short-term burn alerts</li><li>Context-aware burn alerts</li></ul><h4 id=the-baseline-window>The Baseline Window</h4><h4 id=acting-on-slo-burn-alerts>Acting on SLO Burn Alerts</h4><h3 id=using-observability-data-for-slos-versus-time-series-data>Using Observability Data for SLOs Versus Time-Series data</h3><ul><li>Observability data that traces actual user experience with your services is a more accurate representation of system state than coarsely aggregated time-series data.</li></ul><h3 id=conclusion-10>Conclusion</h3><ul><li>SLOs are a modern form of monitoring that solve many of the problems with noisy monitoring we outlined before.</li><li>SLOs are not specific to observability.</li></ul><h2 id=chapter-14-observability-and-the-software-supply-chain>Chapter 14. Observability and the Software Supply Chain</h2><ul><li>software supply chain</li></ul><h1 id=part-iv-observability-at-scale>Part IV. Observability at Scale</h1><h2 id=chatper-15-build-versus-buy-and-return-on-investment>Chatper 15. Build Versus Buy and Return on Investment</h2><h3 id=how-to-anlyze-the-roi-of-observability>How to Anlyze the ROI of Observability</h3><h3 id=the-real-costs-of-building-your-own>The Real Costs of Building Your Own</h3><ul><li>The Hidden Costs of Using &ldquo;Free&rdquo; Software</li><li>The Benefits of Building Your Own</li><li>The Risks of Building Your Own</li></ul><h3 id=the-real-costs-of-buying-software>The Real Costs of Buying Software</h3><ul><li>The Hidden Financial Costs of Commercial Software</li><li>The Hidden Nonfinancial Costs of Commercial Software</li></ul><h3 id=buy-versus-build-is-not-a-binary-choice>Buy Versus Build Is Not a Binary Choice</h3><h2 id=chatper-16-efficient-data-storage>Chatper 16. Efficient Data Storage</h2><h3 id=the-functional-requirements-for-observability>The Functional Requirements for Observability</h3><ul><li>Time-Series Databases Are Inadequate for Observability:<ul><li>Traditionally, a time-series database(TSDB) is used to store aggregated metrics.</li><li>Problem: Cardinality Explosion</li></ul></li><li>Other Possible Data Stores:<ul><li>NoSQL</li><li>Apache Cassandra, Elasticsearch/OpenSearch, ScyllaDB, and InfluxDB</li><li>ClickHouse, Apache Druid</li></ul></li><li>Data Storage Strategies:<ul><li>Row-based Storage:<ul><li>Bigtable</li></ul></li><li>Column-based Storage</li></ul></li></ul><h2 id=chapter-17-cheap-and-accurateenough-sampling>Chapter 17. Cheap and AccurateEnough: Sampling</h2><h3 id=sampling-to-refine-your-data-collection>Sampling to Refine Your Data Collection</h3><ul><li>At scale, the need to refine your data set to optimize for resource costs becomes critical. But even at a smaller scale, where the need to shave resources is less pressing, refining the data you decide to keep can still provide valuable cost savings.</li></ul><h3 id=using-different-approaches-to-sampling>Using Different Approaches to Sampling</h3><h4 id=constant-probability-sampling>Constant-Probability Sampling</h4><ul><li>Constant sampling is not effective in the following circumstances:<ul><li>You care a lot about error cases and not very much about success cases.</li><li>Some customers send orders of magnitude more traffic than others, and you want all customers to have a good experience.</li><li>You want to ensure that a huge increase in traffic on your servers can&rsquo;t overwhelm your analytics backend.</li></ul></li></ul><h4 id=sampling-on-recent-traffic-volume>Sampling on Recent Traffic Volume</h4><h4 id=sampling-based-on-event-content-keys>Sampling Based on Event Content (Keys)</h4><ul><li><p>Events with errors are more important than those with successes.</p></li><li><p>Events for newly placed orders are more important than those checking on order status.</p></li><li><p>Events affecting paying customers are more imporant to keep than those for cusomters using the free tier.</p></li><li><p>Others:</p><ul><li>HTTP method</li></ul></li></ul><h4 id=combining-per-key-and-historical-methods>Combining per Key and Historical Methods</h4><h4 id=choosing-dynamic-sampling-options>Choosing Dynamic Sampling Options</h4><h4 id=when-to-make-a-sampling-decision-for-traces>When to Make a Sampling Decision for Traces</h4><ul><li>tail-based sampling</li></ul><h3 id=translating-sampling-strategies-into-code>Translating Sampling Strategies into Code</h3><ul><li>The Base Case</li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=#ZgotmplZ>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>handler</span>(<span style=color:#a6e22e>resp</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>start</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>callAnotherService</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>RecordEvent</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><ul><li>Fixed-Rate Sampling</li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=#ZgotmplZ>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>sampleRate</span> = <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Int</span>(<span style=color:#e6db74>&#34;sampleRate&#34;</span>, <span style=color:#ae81ff>1000</span>, <span style=color:#e6db74>&#34;Static sample rate&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>handler</span>(<span style=color:#a6e22e>resp</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>start</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>callAnotherService</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Float64</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span> &lt; <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sampleRate</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>RecordEvent</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><ul><li>Recording the Sample Rate</li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=#ZgotmplZ>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>sampleRate</span> = <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Int</span>(<span style=color:#e6db74>&#34;sampleRate&#34;</span>, <span style=color:#ae81ff>1000</span>, <span style=color:#e6db74>&#34;Service&#39;s sample rate&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fun</span> <span style=color:#a6e22e>handler</span>(<span style=color:#a6e22e>resp</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResposneWriter</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>start</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>callAnotherService</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Float64</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span> &lt; <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sampleRate</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>RecordEvent</span>(<span style=color:#a6e22e>req</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>sampleRate</span>, <span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><ul><li>Consistent Sampling:<ul><li>Any full end-to-end trace</li></ul></li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data="var%20sampleRate%20=%20flag.Int%28%22sampleRate%22,%201000,%20%22Service%27s%20sample%20rate%22%29%0a%0afunc%20handler%28resp%20http.ResponseWriter,%20req%20*http.Request%29%20%7b%0a%20%20//%20Use%20an%20upstream-generated%20random%20sampling%20ID%20if%20it%20exists.%0a%20%20//%20otherwise%20we%27re%20a%20root%20span.%20generate%20&%20pass%20down%20a%20random%20ID.%0a%20%20var%20r%20float64%0a%20%20if%20r,%20err%20:=%20floatFromHexBytes%28req.Header.Get%28%22Sampling-ID%22%29%29;%20err%20!=%20nil%20%7b%0a%20%20%20%20r%20=%20rand.Float64%28%29%0a%20%20%7d%0a%0a%20%20start%20:=%20time.Now%28%29%0a%20%20//%20Propagate%20the%20Sampling-ID%20when%20creating%20a%20child%20span%0a%20%20i,%20err%20:=%20callAnotherService%28r%29%0a%20%20resp.Write%28i%29%0a%0a%20%20if%20r%20%3c%201.0%20/%20*sampleRate%20%7b%0a%20%20%20%20RecordEvent%28req,%20*sampleRate,%20start,%20err%29%0a%20%20%7d%0a%7d">
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>sampleRate</span> = <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Int</span>(<span style=color:#e6db74>&#34;sampleRate&#34;</span>, <span style=color:#ae81ff>1000</span>, <span style=color:#e6db74>&#34;Service&#39;s sample rate&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>handler</span>(<span style=color:#a6e22e>resp</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Use an upstream-generated random sampling ID if it exists.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// otherwise we&#39;re a root span. generate &amp; pass down a random ID.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>r</span> <span style=color:#66d9ef>float64</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>floatFromHexBytes</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;Sampling-ID&#34;</span>)); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span> = <span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Float64</span>()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>start</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Propagate the Sampling-ID when creating a child span
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>callAnotherService</span>(<span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span> &lt; <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sampleRate</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>RecordEvent</span>(<span style=color:#a6e22e>req</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>sampleRate</span>, <span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><ul><li>Target Rate Sampling</li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data="var%20targetEventsPerSec%20=%20flag.Int%28%22targetEventsPerSec%22,%205,%0a%20%20%22The%20Target%20number%20of%20requests%20per%20second%20to%20sample%20from%20this%20ervice.%22%29%0a%0avar%20sampleRate%20float64%20=%201.0%0avar%20requestsInPastMinute%20*int%0a%0afunc%20main%28%29%20%7b%0a%20%20//%20Initialize%20counters.%0a%20%20rc%20:=%200%0a%20%20requestsInPastMinute%20=%20&amp;rc%0a%0a%20%20go%20func%28%29%20%7b%0a%20%20%20%20for%20%7b%0a%20%20%20%20%20%20time.Sleep%28time.Minute%29%0a%20%20%20%20%20%20newSampleRate%20=%20*requestsInPastMinute%20/%20%2860%20*%20*targetEventsPerSec%29%0a%20%20%20%20%20%20if%20newSampleRate%20%3c%201%20%7b%0a%20%20%20%20%20%20%20%20sampleRate%20=%201.0%0a%20%20%20%20%20%20%7d%20else%20%7b%0a%20%20%20%20%20%20%20%20sampleRate%20=%20newSampleRate%0a%20%20%20%20%20%20%7d%0a%20%20%20%20%20%20newRequestCounter%20:=%200%0a%20%20%20%20%20%20requestsInPastMinute%20=%20&amp;newRequestCounter%0a%20%20%20%20%7d%0a%20%20%7d%28%29%0a%20%20http.Handler%28%22/%22,%20handler%29%0a%7d%0a%0afun%20handler%28resp%20http.ResponseWriter,%20req%20*http.Request%29%20%7b%0a%20%20var%20r%20float64%0a%20%20if%20r,%20err%20:=%20floatFromHexBytes%28req.Header.Get%28%22Sampling-ID%22%29%29;%20err%20!=%20nil%20%7b%0a%20%20%20%20r%20=%20rand.Float64%28%29%0a%20%20%7d%0a%0a%20%20start%20:=%20time.Now%28%29%0a%20%20*requestsInPastMinute%20++%0a%20%20i,%20err%20:=%20call%20AnotherService%28r%29%0a%20%20resp.Write%28i%29%0a%0a%20%20if%20r%20%3c%201.0%20/%20sampleRate%20%7b%0a%20%20%20%20RecordEvent%28req,%20sampleRate,%20start,%20err%29%0a%20%20%7d%0a%7d">
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>targetEventsPerSec</span> = <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Int</span>(<span style=color:#e6db74>&#34;targetEventsPerSec&#34;</span>, <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;The Target number of requests per second to sample from this ervice.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>sampleRate</span> <span style=color:#66d9ef>float64</span> = <span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>requestsInPastMinute</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Initialize counters.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>rc</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>requestsInPastMinute</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>rc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Minute</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>newSampleRate</span> = <span style=color:#f92672>*</span><span style=color:#a6e22e>requestsInPastMinute</span> <span style=color:#f92672>/</span> (<span style=color:#ae81ff>60</span> <span style=color:#f92672>*</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>targetEventsPerSec</span>)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>newSampleRate</span> &lt; <span style=color:#ae81ff>1</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>sampleRate</span> = <span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>sampleRate</span> = <span style=color:#a6e22e>newSampleRate</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>newRequestCounter</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>requestsInPastMinute</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>newRequestCounter</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Handler</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#a6e22e>handler</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fun</span> <span style=color:#a6e22e>handler</span>(<span style=color:#a6e22e>resp</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>r</span> <span style=color:#66d9ef>float64</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>floatFromHexBytes</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;Sampling-ID&#34;</span>)); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span> = <span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Float64</span>()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>start</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>  <span style=color:#f92672>*</span><span style=color:#a6e22e>requestsInPastMinute</span> <span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>call</span> <span style=color:#a6e22e>AnotherService</span>(<span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span> &lt; <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>sampleRate</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>RecordEvent</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>sampleRate</span>, <span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><ul><li>Having More Than One Static Sample Rate</li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=#ZgotmplZ>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>sampleRate</span> = <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Int</span>(<span style=color:#e6db74>&#34;sampleRate&#34;</span>, <span style=color:#ae81ff>1000</span>, <span style=color:#e6db74>&#34;Service&#39;s sample rate&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>handler</span>(<span style=color:#a6e22e>resp</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>start</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>callAnotherService</span>(<span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Float64</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Since</span>(<span style=color:#a6e22e>start</span>) &gt; <span style=color:#ae81ff>500</span><span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span> &lt; <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>outlierSampleRate</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>RecordEvent</span>(<span style=color:#a6e22e>req</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>outlierSampleRate</span>, <span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span> &lt; <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sampleRate</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>RecordEvent</span>(<span style=color:#a6e22e>req</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>sampleRate</span>, <span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><ul><li>Sampling by Key and Target Rate</li><li>Sampling with Dynamic Rates on Arbitrarily Many Keys</li><li>Putting It All togheter: Head and Tail per Key Target Rate Sampling</li></ul><h2 id=chapter-18-telemetry-mangement-with-pipelines>Chapter 18. Telemetry Mangement with Pipelines</h2><h3 id=attributes-of-telemetry-pipelines>Attributes of Telemetry Pipelines</h3><ul><li>Routing</li><li>Security and Compliance</li><li>Workload Isolation: to protect the reliability and availability of data sets in critical scenarios.</li><li>Data Buffering</li><li>Capacity Management:<ul><li>Rate limiting</li><li>Sampling</li><li>Queuing</li></ul></li><li>Data Filtering and Augmentation</li><li>Data Transformation</li><li>Ensuring Data Quality and Consistency:<ul><li>To use logs as an example:<ul><li>Convert unstructured logs to structured data by extracting sepcific fields</li><li>Detect and redact or filter any PII or sensitive data in the log data</li><li>Convert IP addresses to geographic latitude/longitude fields through the use of geolocation databases such as MaxMind</li><li>Ensure the schema of the log data, to ensure that the expected data exists and that specific fields are of specific types</li><li>Filter low-value logs from being sent to the backend</li></ul></li></ul></li></ul><h3 id=managing-a-telemetry-pipeline-anatomy>Managing a Telemetry Pipeline: Anatomy</h3><ul><li><p>Key components of a telemetry pipeline:</p><ul><li>A receiver collects data from a source:<ul><li>Prometheus scraper</li></ul></li><li>A buffers is a store for the data, often for a short period of time:<ul><li>Kafka</li></ul></li><li>A processor often takes the data from a buffer, applices a transformation to it, and then persists the data back to a buffer.</li><li>An exporter is a component that acts as a sink for the telemetry data. An exporter often takes the data from a buffer and writes that data to a telemetry backend</li></ul></li><li><p>Roles of the receiver, processor, and exporter in a pipeline:</p><ul><li>Trace data:<ul><li>Receiver:<ul><li>Gather trace data in different formats(Zipkin, Jaeger, AWS X-Ray, Otel)</li><li>Gather data from different services ( from all Slack mobile clients)</li></ul></li><li>Exporter or processor:<ul><li>Ingest data into various trace backends</li><li>Perform tail sampling of the data</li><li>Drop low-value traces</li><li>Extract logs from traces</li><li>Route trace data to various backends for compliance needs</li><li>Filter data</li></ul></li></ul></li><li>Metrics data:<ul><li>Receiver:<ul><li>Identify and scrape targets</li></ul></li><li>Exporter or processor:<ul><li>Relabel metrics</li><li>Downample metrics</li><li>Aggregate metrics</li><li>Push data to multiple backends</li><li>Detect high-cardinality tags or time series</li><li>Filter high-cardinality tags or metrics</li></ul></li></ul></li><li>Logs data:<ul><li>Receiver:<ul><li>Gather data from different services</li><li>Endpoitn for collecting logs pushed from different services</li></ul></li><li>Exporter or processor:<ul><li>Parse log data into semistructured or sturctured logs</li><li>Filter PII and sensitive data from logs</li><li>Push data to multiple backends for GDPR resons</li><li>Route infrequently queried or audit logs to flat files, and high-value logs or frequent queries to an indexed system</li></ul></li></ul></li></ul></li></ul><h3 id=challenges-when-managing-a-telemetry-pipeline>Challenges When Managing a Telemetry Pipeline</h3><ul><li>Performance</li><li>Correctness</li><li>Availability</li><li>Reliability</li><li>Isolation</li><li>Data Freshness</li></ul><h3 id=use-case-telemetry-management-at-slack>Use Case: Telemetry Management at Slack</h3><h3 id=open-source-alternatives>Open Source Alternatives</h3><ul><li>Facebook&rsquo;s Scribe</li><li>Logstash, Fluentd</li><li>Prometheus Pushgateway, M3 Aggregator</li></ul><h1 id=part-v-spreading-observability-culture>Part V. Spreading Observability Culture</h1><h2 id=chapter-19-the-business-case-for-observability>Chapter 19. The business Case for Observability</h2><h3 id=the-reactive-approach-to-introducing-change>The Reactive Approach to Introducing Change</h3><ul><li>When to outage occurs</li><li>Dysfunction is no longer tolerated.</li></ul><h3 id=the-return-on-investment-of-observability>The Return on Investment of Observability</h3><ul><li>Observability&rsquo;s four important wyas:<ul><li>Higher incremental revenu:<ul><li>Observability tools helps teams improve uptime and performance, leading to increased incremental revenue directly as a result of improving code quality.</li></ul></li><li>Cost savings from faster incident response:<ul><li>Observability significantly reduces labor costs via faster mean time and detect (MTTD) and mean time to resolve(MTTR), improved query response times, the ability to find bottlenecks quicker, reduction of time spent on call, and time saved by avoiding rollbacks</li></ul></li><li>Cost savings from avoided incidents:<ul><li>Observability tools enable developers to find causes of problems before they become critical and long-lasting, which helps prevent incidents.</li></ul></li><li>Cost savings from decreased employee churn:<ul><li>Implementing observability results in improved job satisfaction and decrease in developer burnout, alert and on-call fatigue, and turnover</li></ul></li></ul></li></ul><h3 id=the-proactive-approach-to-introducing-change>The Proactive Approach to Introducing Change</h3><h3 id=introducing-observability-as-a-practice>Introducing Observability as a Practice</h3><ul><li>The goal of observability is to provide engineering teams the capability to develop, operate, throughly debug, and report on their systems.</li><li>With a blameless culture in practice, business leaders should also ensure that a clear scope of work exists when introducing obserability.</li></ul><h3 id=using-the-approriate-tools>Using the Approriate Tools</h3><h4 id=instrumentation>Instrumentation</h4><ul><li>OTel is the merging standard. No longer lock into one specific vendor.</li></ul><h4 id=data-storage-and-analytics>Data Storage and Analytics</h4><ul><li>Popular opensource data storage layers: Cassandra, Elasticsearch, M3, and InfluxDB</li></ul><h4 id=rolling-out-tools-to-your-teams>Rolling Out Tools to Your Teams</h4><h3 id=knowing-when-you-have-enough-observability>Knowing When You Have Enough Observability</h3><h3 id=conclusion-11>Conclusion</h3><ul><li>The need for observability is recognized within teams for a variety of reasons.</li><li>Similar to security and testability, observability must be approached as an ongoing practice.</li><li>Observability requires onging care and maintenance.</li></ul><h2 id=chapter-20-observabilitys-stakeholders-and-allies>Chapter 20. Observability&rsquo;s Stakeholders and Allies</h2><h3 id=recognizing-nonengineering-observability-needs>Recognizing Nonengineering Observability Needs</h3><ul><li><p>Understanding the adoption of new features. Which customers are using your newly shipped feature? Does that match the list of customers who expressed interest in it? In what ways do useage patterns of active feature users differ from those who tried it but later abandoned the experience?</p></li><li><p>Finding successful product usage trends for new customers. Does the sales team understand which combination of features seems to reasonate with prospects who go on to become customers? Do you understand the product usage commonalities in users that failed to activate your product? Do those point to friction that needs to be eroded somehow?</p></li><li><p>Accurately relaying service availability information to both customers and internal support teams via up-to-date service status pages. Can you provide templated queires so that supprt teams can self-serve when users report outages?</p></li><li><p>Understanding both short-term and long-term reliabili8ty trends. Is reliability improving for users of your software? Dose the shape of that reliability graph match other sources of data, like customer complaints? Are you experiencing fewer outages or more? Are those outages recovering more slowly?</p></li><li><p>Resolving issues proactively. Are you able to find and resolve customer-impacting issues before they are reported by a critical mass of cusomers via support tickets? Are you proactively resolving issues, or are you relying on cusomers to find them for you?</p></li><li><p>Shipping features to cusomters more quickly and reliably. Are deploymenets to production being closely watched to spot performance anomalies and fix them? Can you decouple deployments from releases so that shipping new features is less likely to cause widespread outages?</p></li><li><p>The best way to further your organization-wide observability adoption initiative is to reach out to adjacent teams that could benefit from this knowledge.</p></li></ul><h3 id=creating-observability-allies-in-practice>Creating Observability Allies in Practice</h3><ul><li>skip</li></ul><h3 id=using-observability-versus-business-intelligence-tools>Using Observability Versus Business Intelligence Tools</h3><ul><li>Query Execution Time</li><li>Accuracy</li><li>Recency</li><li>Structure</li><li>Time Windows</li><li>Ephemerality</li></ul><h2 id=chapter-21-an-observability-maturity-model>Chapter 21. An Observability Maturity Model</h2><h3 id=a-note-about-maturity-models>A Note About Maturity Models</h3><ul><li>CMM(Capability Maturity Model):<ul><li>Level 1: Initial(chaotic, ad hoc, individual heroics) - the starting point for use of a new or undocumented repeat process</li><li>Level 2: Repeatable - the process is at least documented sufficiently such that repeating the same steps may be attempted.</li><li>Level 3: Defined - the process is defined/confirmed as a standard business process</li><li>Level 4: Capable - the process is quantitatively managed in accordance with agreed-upon metrics</li><li>Level 5: Efficient - process management includes deliberate process optimization/improvement</li></ul></li><li>Maturaity models can help you identify and quantify tangible and measurable objectives that are useful in driving long-term initiatives.</li><li>Those hypotheses, and the maturity model itself, should be continuously improved over time as more data becomes avaiable.</li></ul><h3 id=why-observability-needs-a-maturity-model>Why Observability Needs a Maturity Model</h3><ul><li>Production software systems present sociotechinal challenges</li></ul><h3 id=about-the-obserability-maturity-model>About the Obserability Maturity Model</h3><ul><li>OMM(Observability Maturity Model):<ul><li>Sustainable sysems and quality of life for engineers</li><li>Delivering against business needs by increasing customer satisfaction</li></ul></li><li>Observability is not aproperty of the computer system alone or the people alone.</li></ul><h3 id=capabilities-refernced-in-the-omm>Capabilities Refernced in the OMM</h3><ul><li>There is no singular and correct order or prescriptive way of doing these things.</li></ul><h4 id=respond-to-system-failure-with-resilience>Respond to System Failure with Resilience</h4><ul><li><p>If your team is doign well:</p><ul><li>System uptime meets your business goals and is improving.</li><li>On-call resposne to alerts is efficient, and alerts are not ignored.</li><li>On-call dutiy is not excessively stressful, and engineers are not hesitant to take additional shifts as needed.</li><li>Engineers can handle incident workload without working extra hours or feeling unduly stressed.</li></ul></li><li><p>If you team is doing poeerly:</p><ul><li>The organization is spending a lot of additional time and money staffing on-call rotations.</li><li>Incidents are frequent and prolonged.</li><li>Those on call suffer from alert fatigue or aren&rsquo;t alerted about real failures</li><li>Incident responders cannot easily diagnose issues.</li><li>Some team members are disproportionately pulled into emergencies.</li></ul></li><li><p>How observability is related:</p><ul><li>Democratization of troubleshooting techiniques by easily sharing past investigation paths helps distribute incident resolution skills across a team, so anyone can effectively respond to incidents as they occur.</li></ul></li></ul><h4 id=deliver-high-quality-code>Deliver High-Quality Code</h4><ul><li><p>If your team is doing well:</p><ul><li>Code is stable, fewer burgs are discoverd in production, and fewer outages occur.</li><li>After code is deployed to production, your team focuses on customer solutions rather than support.</li><li>Engineers find it intutive to debug problems at any stage, from writing code in development to troubleshooting incidents in production at full release scale.</li><li>Isolated issues that occur can typically be fixed withotu triggering cascading failures.</li></ul></li><li><p>If your team is doing poeerly:</p><ul><li>Customer support costs are high.</li><li>A high percentage of engineering time is spent fixing bugs instead of working on new features.</li><li>Team members are often reluctant to deploy new features because of perceived risk.</li><li>It takes a long time to identify an issue, construct a way to reproduce the failure case, and reparie it.</li><li>Developers have low confidence in their code&rsquo;s reliability after it has shipped.</li></ul></li><li><p>How observability is related:</p><ul><li>Well-monitored and tracked code makes it easy to see when and how a process is failing, and easy to identify and fix vulnerable spots.</li><li>Be alerted rapidly, fix before visible to users</li></ul></li></ul><h4 id=manage-complexity-and-technical-debt>Manage Complexity and Technical Debt</h4><ul><li><p>If your team is doing well:</p><ul><li>Engineers spend the majority of their time making forward progress on core business goals.</li><li>Bug fixing and other reactive work takes up a minority of the team&rsquo;s time.</li><li>Engineers spend very little time disoriented or trying to find where in the codebase they need to plumb through changes.</li></ul></li><li><p>If your team is doing poorly:</p><ul><li>Engineering time is wated rebuilding thigns when their scaling limits are reached or edge cases are hit.</li><li>Teams are distracted by fixing the wrong thing or picking the wrong way to fix something.</li><li>Engineers frequently experience uncontrollable ripple effects from a localized change.</li><li>People are afraid to make changes to the code, aka the &ldquo;haunted graveyard&rdquo; effect.</li></ul></li><li><p>How observability is related:</p><ul><li>Observability enables teams to understand the end-to-end performance of their systems and debug failures and slowness without wasting time.</li></ul></li></ul><h4 id=release-on-a-predictable-cadence>Release on a Predictable Cadence</h4><ul><li><p>If your team is doing well:</p><ul><li>The release cadence matches business needs and customer expectations.</li><li>Code gest into production shortly after being written. Engieers can trigger deployment of their own code after it&rsquo;s been peer reviewed, satisfies controls, and is checked in.</li><li>Code paths can be enabled or disabled instantly, without needing a deployment.</li><li>Deployments and rollbacks are fast.</li></ul></li><li><p>If your team is doing poorly:</p><ul><li>Releases are infrequent and require lots of human intervention.</li><li>Lots of changes are shipped at once.</li><li>Releases have to happen in a particular order.</li><li>The sales team has to gate promises on a particular release train.</li><li>Teams avoid deploying on certain days or times of year. They are hesitant because poorly managed release cycles have frequently interfered with quality of life during nonbusiness hours.</li></ul></li><li><p>How observability is related:</p><ul><li>Observability is how your understand the build pipeline as well as production.</li><li>Observability and instrumentation are also how you gain confidence in your release.</li></ul></li></ul><h4 id=understand-user-behavior>Understand User Behavior</h4><ul><li><p>If your team is doing well:</p><ul><li>Instrumentation is easy to add and augment.</li><li>Developers have easy access to key performance indicators (KIPs) for customer outcomes and system utilization/cost, and can visualize them side by side.</li><li>Feature flagging or similar makes it possible to iterate rapidly with a small subset of users before fully launching.</li><li>Product managers cna get a useful view of customer feedback and behavior.</li><li>Product-market fit is easier to achieve.</li></ul></li><li><p>If your team is doing poorly:</p><ul><li>Product managers don&rsquo;t have enought data to make good decisions about what to build next.</li><li>Developers feel that their work doesn&rsquo;t have impact.</li><li>Product features grow to excessive scope, are designed by committe, or don&rsquo;t receive customer feedback until late in the cycle.</li><li>Product-market fit is not achieved.</li></ul></li><li><p>How observability is related:</p><ul><li>Effective product management requires access to relavant data.</li></ul></li></ul><h3 id=using-the-omm-for-your-organization>Using the OMM for Your Organization</h3><ul><li>To remember that creatign a mature observability practice is not a linear progression and that these capabilities do not exist in a vaccum.</li></ul><h3 id=conclusion-12>Conclusion</h3><ul><li>How they respond to system failure with resilience</li><li>How easily they can deliver high-quality code</li><li>How well they manage complexity and technical debt</li><li>How predictable their software release cadence is</li><li>How well they can understand user behavior</li></ul><h2 id=chatper-22-where-to-go-from-here>Chatper 22. Where to Go from Here</h2><ul><li>Observability for software systems is a measure of how well you can understand and explain any state your system can get into, no matter how novel or bizarre. You must be able to comparatively debug that bizarre or novel state across all dimensions of system state data, and combinations of dimensions, in an ad hoc iterative investigation, without being required to define or predict those debugging needs in advance. If you can understand any bizarre or novel state without needing to ship new code, you have observability.</li></ul><h3 id=observability-then-versus-now>Observability, Then Versus Now</h3><h3 id=additional-resource>Additional Resource</h3><ul><li>Site Reliability Engineering</li><li>Implementing Service Level Objectives</li><li>Cloud Native Observability with OpenTelemetry</li><li>Distributed Tracing in Practice</li><li>Honycomb&rsquo;s blog</li></ul><h3 id=predictions-for-where-observability-is-going>Predictions for Where Observability Is Going</h3><ul><li>Otel</li><li>RUM(real user monitoring):<ul><li>colelction and recording web traffic</li><li>without impacting code performance</li></ul></li><li>synthetic monitoring:<ul><li>allow proactive testing</li><li>catch performance issues before they can possibly create impacts to real users.</li></ul></li></ul></div><hr><div class=list-files><ul class=section-tree></ul></div></article><script src=/js/wikilink.js></script><div><script src=https://utteranc.es/client.js repo=minuk-dev/minuk-dev.github.io issue-term=pathname theme=github-dark crossorigin=anonymous async></script></div></main><footer class=footer><div class=footer-left></div><div class=footer-right><ul class=social><li><a href=/about>About</a></li><li><a href=https://github.com/minuk-dev>Github</a></li></ul></div></footer></body><script src=/js/dir_toggle.js></script><script src=/js/codeblock_copy.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css><script type=module>
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs";
mermaid.initialize({
  startOnLoad: true,
  theme: "dark",
});
</script></html>