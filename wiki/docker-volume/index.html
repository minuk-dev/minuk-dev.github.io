<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Docker Volume</title><style>html body{font-family:raleway,sans-serif;background-color:#fff}:root{--accent: #00a3d2;--border-width:  5px }</style><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/css/copy-btn.css><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script src=/js/copy-btn.js></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script>$(document).on('click',function(){$('.collapse').collapse('hide');})</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-98056974-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-98056974-1');</script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><meta name=google-site-verification content="g_3tJyj-KkW-_wKx7Ij5GimHV1nKPZXetCz8ydbBAfA"></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class=container><div class=navbar-header><a class="navbar-brand visible-xs" href=#>Docker Volume</a>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href=/>Home</a></li><li><a href=/wiki/>Wiki</a></li><li><a href=/posts/>Posts</a></li><li><a href=/about/>About</a></li></ul><ul class="nav navbar-nav navbar-right"><li class=navbar-icon><a href=mailto:makerdark98@gmail.com><i class="fa fa-envelope-o"></i></a></li><li class=navbar-icon><a href=https://github.com/makerdark98/><i class="fa fa-github"></i></a></li><li><div style=max-width:250px;display:inline-block;max-height:40px><script async src="https://cse.google.com/cse.js?cx=003491619885022567520:wnnypdnx4aj"></script><div class=gcse-search></div></div></li></ul></div></div></nav><main><div class=navigator style=display:flex><div style=display:flex><a href=/wiki><button class="btn btn-link"><i class="fa fa-arrow-left"></i>&nbsp;Front Page</button></a></div><div style=margin-left:auto><div style=display:flex><div style=margin-left:auto><div class=wiki-history></div></div></div><script src=/js/localhistory.js></script><script>var now="Docker Volume"
pushHistory(now);</script></div></div><div><h2>Docker Volume</h2><a href=https://github.com/makerdark98/makerdark98.github.io/blame/master/src/content/wiki/Docker%20Volume.md><h5>created : Tue, 07 Apr 2020 20:21:35 +0900</h5><h5>modified : Wed, 08 Apr 2020 12:57:20 +0900</h5></a><div class=parent-doc style=flex:none></div></div><aside class=navbar id=nav-toc style=text-align:left><nav id=TableOfContents><ul><li><a href=#71httpswwwjoinccokrwman12dockerguidedatawithcontainertoc볼륨-만들기><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>7.1.</a> 볼륨 만들기</a></li><li><a href=#72httpswwwjoinccokrwman12dockerguidedatawithcontainertoc볼륨-목록-확인><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>7.2.</a> 볼륨 목록 확인</a></li><li><a href=#73httpswwwjoinccokrwman12dockerguidedatawithcontainertoc볼륨-삭제><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>7.3.</a> 볼륨 삭제</a></li><li><a href=#74httpswwwjoinccokrwman12dockerguidedatawithcontainertoc볼륨-정보-확인><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>7.4.</a> 볼륨 정보 확인</a></li></ul></nav></aside><div align=start class=content data-spy=scroll data-offset=20 data-target=#nav-toc style=position:relative><h1 id=1httpswwwjoinccokrwman12dockerguidedatawithcontainertoc데이터-볼륨><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>1.</a> 데이터 볼륨</h1><p>도커는 하나의 이미지로 부터 여러 컨테이너를 만들기 위해서</p><p><strong>Union File system</strong></p><p>을 사용한다. 유니온 파일 시스템은 원본 이미지에 변경된 내용(diff)를 추가하는 방식이므로, 다른 컨테이너에서 사용 할 수 없다. 애플리케이션에 따라서는 데이터를 다른 컨테이너와 공유 하거나 혹은 호스트에서 접근 할 수 있어야 하는 경우가 있는데, 이때 데이터 볼륨을 사용한다. 데이터 볼륨은 <strong>호스트의 파일 시스템</strong>을 컨테이너에서 마운트 하는 방식으로 사용한다. 아래와 같은 특징이 있다.</p><ul><li>데이터 볼륨은 호스트 운영체제의 파일 시스템을 사용한다. <a href=https://www.joinc.co.kr/w/man/12/docker/aufs>AUFS</a>와 Overlay 파일시스템 같은 유니온 파일 시스템은 (ext4같은)네이티브 파일시스템위에 올라가기 때문에 아무래도 성능이 떨어진다. 데이터 볼륨으로 이런 단점을 극복 할 수 있다.</li><li>데이터 볼륨은 재사용 가능하며, 컨테이너들 간에 공유 할 수 있다.</li><li>데이터 볼륨은 호스트에서 직접 접근 할 수 있다.</li><li>데이터 볼륨은 컨테이너가 삭제되도 계속 유지된다. 기본적으로 컨테이너와 독립적으로 운영되기 때문이다.</li></ul><p>데이터 볼륨은 컨테이너의 주기와는 독립적으로 작동하며, 데이터를 유지(persist data)하기 위해서 사용한다. 도커는 컨테이너를 삭제 할 때, 자동으로 볼륨을 삭제하지 않는다. 더 이상 사용하지 않는 볼륨 <strong>gargabe collect</strong> 해줘야 한다.</p><h1 id=2httpswwwjoinccokrwman12dockerguidedatawithcontainertoc데이터-볼륨-추가><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>2.</a> 데이터 볼륨 추가</h1><p>도커 컨테이너를 만들 때(docker run), <strong><code>-v</code></strong> 옵션을 이용해서 컨테이너에 데이터 볼륨을 추가 할 수 있다.</p><p><strong><code>-v</code></strong>뒤에 마운트할 볼륨을 나열하면 된다. 하나의 데이터 볼륨을 포함하는 컨테이너를 만들어보자.</p><pre><code>docker run --name web -i -t -v /webapp ubuntu /bin/bash
</code></pre><p>컨테이너에 <strong><code>/webapp</code></strong> 디렉토리가 만들어진다. 이 디렉토리는 호스트의 파일 시스템과 마운트된다. 마운트 경로는 <strong><code>docker inspect</code></strong>로 확인 할 수 있다.</p><pre><code>docker inspect web
</code></pre><p>/webapp 디렉토리가 <strong>Source</strong>에 설정된 디렉토리에 마운트됐다. /webapp에 파일을 쓰면 <strong>Source</strong>디렉토리에 파일이 만들어지는 걸 확인 할 수 있다.</p><p>&ldquo;-v"를 여러 개 이용해서 하나 이상의 데이터 볼륨을 만들 수 있다.</p><h1 id=3httpswwwjoinccokrwman12dockerguidedatawithcontainertoc호스트-디렉토리를-디렉토리로-설정><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>3.</a> 호스트 디렉토리를 디렉토리로 설정</h1><p>호스트의 특정 디렉토리를 컨테이너로 마운트 할 수도 있다.</p><pre><code>docker run -i -t -v /src/webapp:/dst/webapp ubuntu /bin/bash
</code></pre><p>호스트 디렉토리 <strong>/src/webapp</strong> 을 컨테이너 디렉토리 <strong>/dst/webapp</strong> 로 마운트 한다. 호스트 디렉토리와 컨테이너 디렉토리는 반드시**완전경로(full path)**이어야 한다.</p><p>호스트 디렉토리에 있는 파일을 컨테이너에서 읽을 수 있기 때문에, 테스트등에 유용하게 사용 할 수 있다. 볼륨은 기본적으로 읽기&쓰기 모드로 마운트되지만, 읽기 전용으로 마운트 할 수도 있다.</p><pre><code>docker run -i -t -v /src/webapp:/dst/webapp:ro ubuntu /bin/bash
</code></pre><h1 id=4httpswwwjoinccokrwman12dockerguidedatawithcontainertoc볼륨의-공유><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>4.</a> 볼륨의 공유</h1><p>컨테이너가 가지고 있는 볼륨을 다른 컨테이너와 공유 할 수도 있다. 다른 컨테이너와 공유하려면 볼륨에 이름(Name)이 있어야한다. 도커에서 제공하는 네임드 데이터 볼륨 컨테이너(Named data volume container)를 이용해서 공유 할 수 있다. <strong>joincapp</strong>라는 이름의 볼륨을 만들어서 공유하기로 했다.</p><pre><code>docker create -v /joincapp --name joincapp ubuntu /bin/true8103966e331a20c707708cd70f62698fb6335f8baaf5881457a754686210e1b4
</code></pre><p>반환 하는 값은 볼륨 컨테이너의 ID로 /var/lib/docker/containers/&lt;conainer_id>에서 확인 할 수 있다. 컨테이너의 설정 정보는 config.json 이 가지고 있다.</p><pre><code>cat config.json | json_pp { &quot;State&quot; : { &quot;Restarting&quot; : false, &quot;OOMKilled&quot; : false, &quot;Running&quot; : false, &quot;ExitCode&quot; : 0, &quot;StartedAt&quot; : &quot;0001-01-01T00:00:00Z&quot;, &quot;FinishedAt&quot; : &quot;0001-01-01T00:00:00Z&quot;, &quot;Pid&quot; : 0, &quot;Paused&quot; : false, &quot;Error&quot; : &quot;&quot; }, &quot;AppArmorProfile&quot; : &quot;&quot;, &quot;ResolvConfPath&quot; : &quot;&quot;, &quot;HostsPath&quot; : &quot;&quot;, &quot;Image&quot; : &quot;07f8e8c5e66084bef8f848877857537ffe1c47edd01a93af27e7161672ad0e95&quot;, &quot;Created&quot; : &quot;2015-05-13T07:24:32.524168199Z&quot;, &quot;Volumes&quot; : { &quot;/joincapp&quot; : &quot;/var/lib/docker/vfs/dir/1d709224a3642c60b0a2c3ec3842357065461185797c6c14daad939846648635&quot; },....
</code></pre><p>주요 값들을 살펴보자.</p><ul><li>Volumes : 컨테이너가 사용하는 볼륨의 목록을 가지고 있다. 앞서 만든 /joincapp 볼륨을 확인할 수 있다. /joincapp 에서 작업한 내용들은 이 경로에 저장된다.</li><li>ID : 컨테이너의 아이디</li><li>Name : 컨테이너 이름</li><li>VolumesRW : 읽기/쓰기가 가능한 볼륨의 목록을 가지고 있다. /joincapp은 true로 설정된다.</li></ul><p>이렇게 만든 볼륨 컨테이너는 <strong>&ndash;volumes-from</strong>을 이용해서 공유할 수 있다.</p><pre><code># docker run -it --volumes-from joincapp ubuntu /bin/bash
</code></pre><p>/joincapp 디렉토리 밑에서 작업을 해보자. Volumes 설정의 디렉토리에 작업내용이 반영되는 걸 확인할 수 있을 거다. 사실상 Volumes 설정된 디렉토리를 컨테이너들이 공유하는 거라고 보면 된다.</p><p>도커는 사용하지 않는 볼륨컨테이너에 대한 가비지 컬랙션 기능을 제공하지 않는다. 메뉴얼하게 직접 삭제해야 한다. 관리 애플리케이션을 만들어야 한다는 이야기.</p><p>도커의 볼륨 컨테이너는 좋은 기능이긴 하지만 호스트에 종속적이다. 개인이 사용할 때는 문제가 없지만, 도커 기반의 클라우드 인프라를 구축 할 경우 문제가 될 수 있다. 원격에 볼륨을 만들어서 마운트 후 사용하는 등의 방법을 사용해야 한다. NFS나 iSCSI등을 활용 하면 되겠다. 서비스 하기에는 iSCSI가 더 적당할 것 같다.</p><h1 id=5httpswwwjoinccokrwman12dockerguidedatawithcontainertoc호스트-파일을-마운트하기><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>5.</a> 호스트 파일을 마운트하기</h1><p><strong>-v</strong> 옵션으로 호스트 파일을 마운트 할 수도 있다.</p><pre><code>docker run --rm -it -v ~/.bash_history:/root/.bash_history ubuntu /bin/bash
</code></pre><p>위 예제에서는 호스트에 있는 .bash_history 파일을 컨테이너의 /root/.bash_history로 마운트 했다. 이제 컨테이너에서 수행한 쉘 커맨드들은 호스트의 히스토리 파일에 쌓인다.</p><h1 id=6httpswwwjoinccokrwman12dockerguidedatawithcontainertoc백업-복구-마이그레이션><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>6.</a> 백업, 복구, 마이그레이션</h1><p>또 다른 유용한 기능으로 백업,복구,마이그레이션이 있다. &ndash;volumes-from 옵션을 이용해서 마운트된 볼륨을 백업할 수 있다.</p><pre><code>docker run --volumes-from dbdata -v /backup:/backup \ ubuntu tar cvzf /backup/backup.tar.gz /dbdata
</code></pre><ul><li>&ndash;volumes-from 으로 dbdata를 컨테이너에</li><li>로컬의 /backup을 컨테이너의 /backup으로 마운트 한다.</li><li>tar 명령을 이용해서 /dbdata 볼륨을 /backup/backup.tar.gz으로 백업한다.</li></ul><p>복구하는 방법이다.</p><pre><code># docker run --volumes-from dbdata2 -v /backup:/backup ubuntu \ tar xvzf /backup/backup.tar.gz
</code></pre><ul><li>dbdata2 볼륨으로 컨테이너를 실행한다. 복구한 파일의 정보는 dbdata2 볼륨에 저장돼서 다른 컨테이너에서 사용 할 수 있다.</li><li>로컬의 /backup을 컨테이너의 /backup으로 마운트 한다.</li><li>tar 명령을 이용해서 backup.tar.gz의 압축을 푼다.</li></ul><p>복구한 데이터 볼륨으로 컨테이너를 실행했다.</p><pre><code># docker run --volumes-from dbdata2 -it ubuntu /bin/bash
</code></pre><h1 id=7httpswwwjoinccokrwman12dockerguidedatawithcontainertoc볼륨-명령어들><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>7.</a> 볼륨 명령어들</h1><h2 id=71httpswwwjoinccokrwman12dockerguidedatawithcontainertoc볼륨-만들기><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>7.1.</a> 볼륨 만들기</h2><p><strong>docker volume create</strong></p><p>명령으로 볼륨을 만들 수 있다.</p><pre><code>$ docker volume create --name hellohello
</code></pre><p>volume은 /var/lib/docker/volumes/hello 밑예 만뜰어찐따. insepct로 확인 할 수 있다.</p><p>12345678910$ docker volume inspect hello[ { &ldquo;Name&rdquo;: &ldquo;hello&rdquo;, &ldquo;Driver&rdquo;: &ldquo;local&rdquo;, &ldquo;Mountpoint&rdquo;: &ldquo;/var/lib/docker/volumes/hello/_data&rdquo;, &ldquo;Labels&rdquo;: {}, &ldquo;Scope&rdquo;: &ldquo;local&rdquo; }]</p><p>이렇게 만든 볼륨은 다른 컨테이너에서 마운트해서 사용 할 수 있다.</p><pre><code>$ docker run -it -v hello:/world ubuntu /bin/bash
</code></pre><h2 id=72httpswwwjoinccokrwman12dockerguidedatawithcontainertoc볼륨-목록-확인><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>7.2.</a> 볼륨 목록 확인</h2><p><strong>docker volume ls</strong></p><p>명령으로 전체 볼륨 목록을 확인할 수 있다.</p><pre><code>$ docker volume lsDRIVER VOLUME NAMElocal ec75c47aa8b8c61fdabcf37f89dad44266841b99dc4b48261a4757e70357ec06local f73e499de345187639cdf3c865d97f241216c2382fe5fa67555c64f258892128local tmp_data
</code></pre><h2 id=73httpswwwjoinccokrwman12dockerguidedatawithcontainertoc볼륨-삭제><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>7.3.</a> 볼륨 삭제</h2><p><strong>docker volume rm</strong></p><p>명령으로 볼륨을 지울 수 있다.</p><pre><code>docker volume rm ec75c47aa8b8c61fdabcf37f89dad44266841b99dc4b48261a4757e70357ec06
</code></pre><p><strong>docker volume prune</strong></p><p>명령으로 사용하지 않는 모든 볼륨을 지울 수 있다.</p><h2 id=74httpswwwjoinccokrwman12dockerguidedatawithcontainertoc볼륨-정보-확인><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>7.4.</a> 볼륨 정보 확인</h2><p><strong>docker volume inspect</strong></p><p>로 볼륨의 상세 정보를 확인 할 수 있다.</p><pre><code>$ docker volume inspect 3414f529824e3947152367a8c6dddb0c9f2c751dfcb82876bb4b612bf9fa9c49[ { &quot;Name&quot;: &quot;3414f529824e3947152367a8c6dddb0c9f2c751dfcb82876bb4b612bf9fa9c49&quot;, &quot;Driver&quot;: &quot;local&quot;, &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/3414f529824e3947152367a8c6dddb0c9f2c751dfcb82876bb4b612bf9fa9c49/_data&quot;, &quot;Labels&quot;: null, &quot;Scope&quot;: &quot;local&quot; }]
</code></pre><h1 id=8httpswwwjoinccokrwman12dockerguidedatawithcontainertoc참고><a href=https://www.joinc.co.kr/w/man/12/docker/Guide/DataWithContainer#toc>8.</a> 참고</h1><ul><li><a href=https://www.joinc.co.kr/w/man/12/docker/InfrastructureForDocker/storage>도커를 위한 파일 시스템 구성</a></li></ul></div><script>function convertWikiLink(elem){elem.innerHTML=elem.innerHTML.replace(/\[\[(.+?)\]\]\{(.+?)\}/g,(original,matching,display)=>{return `<a href="/wiki/${matching.toLowerCase().replace(/ /g,'-').replace(/[()]/g,'')}">${display}</a>`;});elem.innerHTML=elem.innerHTML.replace(/\[\[(.+?)\]\]/g,(original,matching)=>{var display=matching;if(display==="_index"){display="Front Page";matching="";}
return `<a href="/wiki/${matching.toLowerCase().replace(/ /g,'-').replace(/[()]/g,'')}">${display}</a>`;});};(function(){var content=document.querySelector('.content');convertWikiLink(content);var parent=document.querySelector('.parent-doc');if(parent)convertWikiLink(parent);})();</script><div><script src=https://utteranc.es/client.js repo=makerdark98/makerdark98.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></main><footer><p class="copyright text-muted">© All rights reserved. Powered by <a href=https://gohugo.io>Hugo</a> and <a href=https://github.com/calintat/minimal>Minimal</a>.</p></footer></body></html>