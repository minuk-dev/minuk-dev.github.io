<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://unpkg.com/simpledotcss/simple.css><link rel=stylesheet href=/css/main.css><meta name=generator content="Hugo 0.140.0"><meta name=description content="minuk.dev wiki"><meta name=keywords content="hugo,site,new"><meta name=author content="Min-Uk.Lee"><title>Pintos |
minuk dev wiki
</title><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script></head><body><header class=header><div class=header_left><a href=/><img class=logo src=/images/Rb.png alt=logo>
MinUk.Dev</a></div><div class=header_middle>Pintos</div></header><main><article class=main><div class=title><h1 class=title-header>Pintos</h1></div><a href=https://github.com/minuk-dev/minuk-dev.github.io/blame/master/content/wiki/Pintos.md><h5>created : Tue, 07 Apr 2020 20:20:28 +0900</h5><h5>modified : Sat, 27 Jun 2020 14:54:37 +0900</h5></a><div class=article-meta><div class="breadcumb content"><i class="bi bi-folder"></i>
[[front page]]</div></div><div class=list-terms><ul><i class="bi bi-tags" title=Tags></i>
<a href=/tags/pintos class=tag-btn>pintos</a></ul></div><aside class=navbar id=nav-toc style=text-align:left><nav id=TableOfContents><ul><li><a href=#설정하기-configuration>설정하기 Configuration</a><ul><li><a href=#프로젝트-기본-다운로드>프로젝트 기본 다운로드</a></li><li><a href=#vim-설정하기>vim 설정하기</a></li><li><a href=#shutdown-버그-수정>shutdown 버그 수정</a></li></ul></li><li><a href=#thread><code>thread</code></a></li></ul></nav></aside><div class=content><h2 id=설정하기-configuration>설정하기 Configuration</h2><h3 id=프로젝트-기본-다운로드>프로젝트 기본 다운로드</h3><ul><li>대부분 우분투에서 설정할테니, 다른사람들이 잘 설정해좋은거 다운 받자</li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=#ZgotmplZ>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ git clone https://github.com/kumardeepakr3/PINTOS-Ubuntu.git
</span></span><span style=display:flex><span>$ cd PINTOS-Ubuntu
</span></span><span style=display:flex><span>$ bash ./pintos_ubuntu.sh</span></span></code></pre></div></div><ul><li>여기서 9,10 작업은 필요가 없는 작업이니 다시 원복해주자</li></ul><h3 id=vim-설정하기>vim 설정하기</h3><ul><li>나는 vim(정확히는 neovim)으로 코딩할꺼니 자동완성 같은걸 설정해주자</li><li>여기서는 [[coc]], [[tagbar]], [[ALE]], [[cscope]]를 사용해서 설정했다.</li></ul><h4 id=coc>coc</h4><ul><li>ccls 를 설치하고</li><li>CocLocalConfig를 명령어로 친뒤</li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=#ZgotmplZ>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;languageserver&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;ccls&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;command&#34;</span>: <span style=color:#e6db74>&#34;ccls&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;filetypes&#34;</span>: [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;c&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;cpp&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;objc&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;objcpp&#34;</span>
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;rootPatterns&#34;</span>: [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;.ccls&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;compile_commands.json&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;.vim/&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;.git/&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;.hg/&#34;</span>
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;initializationOptions&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;cache&#34;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;directory&#34;</span>: <span style=color:#e6db74>&#34;/tmp/ccls&#34;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;clang&#34;</span>: {
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;resourceDir&#34;</span>: <span style=color:#e6db74>&#34;.&#34;</span>,
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;extraArgs&#34;</span>: [<span style=color:#e6db74>&#34;-isystem./&#34;</span>, <span style=color:#e6db74>&#34;-isystem./lib/kernel&#34;</span>, <span style=color:#e6db74>&#34;-isystem./lib&#34;</span>]
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><h4 id=tagbar-ale-설정>tagbar, ale 설정</h4><ul><li>local.vim(프로젝트 폴더에다가 두는 vimrc 설정, 자세한건 [[vim]] 참조)</li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data=#ZgotmplZ>
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vimrc data-lang=vimrc><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>g</span>:<span style=color:#a6e22e>ale_linters</span>= { <span style=color:#e6db74>&#39;c&#39;</span> : [<span style=color:#e6db74>&#39;g++&#39;</span>], <span style=color:#e6db74>&#39;cpp&#39;</span> : [<span style=color:#e6db74>&#39;g++&#39;</span>] }
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>g</span>:<span style=color:#a6e22e>ale_c_gcc_options</span>=<span style=color:#e6db74>&#34;-I. -I./lib/kernel -I./lib -Wall&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>g</span>:<span style=color:#a6e22e>ale_cpp_gcc_options</span>=<span style=color:#e6db74>&#34;-I. -I./lib/kernel -I./lib -Wall&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span>! <span style=color:#a6e22e>LoadCscope</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>db</span> = <span style=color:#a6e22e>findfile</span>(<span style=color:#e6db74>&#34;cscope.out&#34;</span>, <span style=color:#e6db74>&#34;.;&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (!<span style=color:#a6e22e>empty</span>(<span style=color:#a6e22e>db</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>path</span> = <span style=color:#a6e22e>strpart</span>(<span style=color:#a6e22e>db</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>match</span>(<span style=color:#a6e22e>db</span>, <span style=color:#e6db74>&#34;/cscope.out$&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>set</span> <span style=color:#a6e22e>nocscopeverbose</span> <span style=color:#75715e>&#34; suppress &#39;duplicate connection&#39; error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exe</span> <span style=color:#e6db74>&#34;cs add &#34;</span> . <span style=color:#a6e22e>db</span> . <span style=color:#e6db74>&#34; &#34;</span> . <span style=color:#a6e22e>path</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>set</span> <span style=color:#a6e22e>cscopeverbose</span>
</span></span><span style=display:flex><span><span style=color:#75715e>  &#34; else add the database pointed to by environment variable</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>elseif</span> $<span style=color:#a6e22e>CSCOPE_DB</span> != <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cs</span> <span style=color:#a6e22e>add</span> $<span style=color:#a6e22e>CSCOPE_DB</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>endif</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>endfunction</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>au</span> <span style=color:#a6e22e>BufEnter</span> /* <span style=color:#a6e22e>call</span> <span style=color:#a6e22e>LoadCscope</span>()</span></span></code></pre></div></div><h3 id=shutdown-버그-수정>shutdown 버그 수정</h3><ul><li>pintos를 키면 계속 죽는다.</li><li><code>src/devices/shutdown.c</code> 에서</li></ul><div class=codeblock><div class=copy-button-box><button class=copy-button state=copy data="%20%20%20/*%20This%20is%20a%20special%20power-off%20sequence%20supported%20by%20Bochs%20and%0a%20%20%20%20%20%20QEMU,%20but%20not%20by%20physical%20hardware.%20*/%0a%20%20%20for%20%28p%20=%20s;%20*p%20!=%20%27%5c0%27;%20p++%29%0a%20%20%20%20%20outb%20%280x8900,%20*p%29;%0a%0a+%20%20outw%20%280x604,%200x0%20%7c%200x2000%29;%20/*%20Fix%20shutdown%20*/%0a+%0a%20%20%20/*%20This%20will%20power%20off%20a%20VMware%20VM%20if%20%22gui.exitOnCLIHLT%20=%20TRUE%22%0a%20%20%20%20%20%20is%20set%20in%20its%20configuration%20file.%20%20%28The%20%22pintos%22%20script%20does%0a%20%20%20%20%20%20that%20automatically.%29%20%20*/%0a%20%20%20asm%20volatile%20%28%22cli;%20hlt%22%20:%20:%20:%20%22memory%22%29;%0a%0a%20%20%20/*%20None%20of%20those%20worked.%20*/">
<i class="bi bi-copy"></i></button></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>   <span style=color:#75715e>/* This is a special power-off sequence supported by Bochs and
</span></span></span><span style=display:flex><span><span style=color:#75715e>      QEMU, but not by physical hardware. */</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>for</span> (p <span style=color:#f92672>=</span> s; <span style=color:#f92672>*</span>p <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;\0&#39;</span>; p<span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>outb</span> (<span style=color:#ae81ff>0x8900</span>, <span style=color:#f92672>*</span>p);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span>  <span style=color:#a6e22e>outw</span> (<span style=color:#ae81ff>0x604</span>, <span style=color:#ae81ff>0x0</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0x2000</span>); <span style=color:#75715e>/* Fix shutdown */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>/* This will power off a VMware VM if &#34;gui.exitOnCLIHLT = TRUE&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>      is set in its configuration file.  (The &#34;pintos&#34; script does
</span></span></span><span style=display:flex><span><span style=color:#75715e>      that automatically.)  */</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>asm</span> <span style=color:#66d9ef>volatile</span> (<span style=color:#e6db74>&#34;cli; hlt&#34;</span> <span style=color:#f92672>:</span> <span style=color:#f92672>:</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;memory&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>/* None of those worked. */</span></span></span></code></pre></div></div><p>로 추가해준다.</p><h2 id=thread><code>thread</code></h2></div><hr><div class=list-files><ul class=section-tree></ul></div></article><script src=/js/wikilink.js></script><div><script src=https://utteranc.es/client.js repo=minuk-dev/minuk-dev.github.io issue-term=pathname theme=github-dark crossorigin=anonymous async></script></div></main><footer class=footer><div class=footer-left></div><div class=footer-right><ul class=social><li><a href=/about>About</a></li><li><a href=https://github.com/minuk-dev>Github</a></li></ul></div></footer></body><script src=/js/dir_toggle.js></script><script src=/js/codeblock_copy.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css><script type=module>
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs";
mermaid.initialize({
  startOnLoad: true,
  theme: "dark",
});
</script></html>