<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>simple-ssd</title><style>html body{font-family:raleway,sans-serif;background-color:#fff}:root{--accent: #00a3d2;--border-width:  5px }</style><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway"><link rel=stylesheet href=/vendor/bootstrap-3.3.7-dist/css/bootstrap.min.css><link rel=stylesheet href=/vendor/font-awesome-4.7.0/css/font-awesome.min.css><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/css/copy-btn.css><script src=/js/copy-btn.js></script><script src=/vendor/jquery-3.4.1.min.js></script><script src=/vendor/bootstrap-3.3.7-dist/js/bootstrap.min.js></script><script>$(document).on('click',function(){$('.collapse').collapse('hide');})</script><script type=text/javascript async src="/vendor/MathJax-2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><meta name=google-site-verification content="g_3tJyj-KkW-_wKx7Ij5GimHV1nKPZXetCz8ydbBAfA"></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class=container><div class=navbar-header><a class="navbar-brand visible-xs" href=#>simple-ssd</a>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href=/>Home</a></li><li><a href=/wiki/>Wiki</a></li><li><a href=/posts/>Posts</a></li><li><a href=/about/>About</a></li></ul><ul class="nav navbar-nav navbar-right"><li class=navbar-icon><a href=mailto:makerdark98@gmail.com><i class="fa fa-envelope-o"></i></a></li><li class=navbar-icon><a href=https://github.com/makerdark98/><i class="fa fa-github"></i></a></li><li><div style=max-width:250px;display:inline-block;max-height:40px><script async src="https://cse.google.com/cse.js?cx=003491619885022567520:wnnypdnx4aj"></script><div class=gcse-search></div></div></li></ul></div></div></nav><main><div class=navigator style=display:flex><div style=display:flex><a href=/wiki><button class="btn btn-link"><i class="fa fa-arrow-left"></i>&nbsp;Front Page</button></a></div><div style=margin-left:auto><div style=display:flex><div style=margin-left:auto><div class=wiki-history></div></div></div><script src=/js/localhistory.js></script><script>var now="simplessd"
pushHistory(now);</script></div></div><div><h2>simple-ssd</h2><a href=https://github.com/makerdark98/makerdark98.github.io/blame/master/src/content/wiki/simplessd.md><h5>created : Wed, 10 Jun 2020 19:39:41 +0900</h5><h5>modified : Thu, 11 Jun 2020 20:24:34 +0900</h5></a><div class=parent-doc style=flex:none></div></div><aside class=navbar id=nav-toc style=text-align:left><nav id=TableOfContents><ul><li><a href=#새롭게-알게된-것>새롭게 알게된 것</a></li><li><a href=#다운로드>다운로드</a></li><li><a href=#문서-읽기>문서 읽기</a><ul><li><a href=#host-interface-layer>Host Interface Layer</a></li></ul></li></ul></nav></aside><div align=start class=content data-spy=scroll data-offset=20 data-target=#nav-toc style=position:relative><h2 id=새롭게-알게된-것>새롭게 알게된 것</h2><ul><li>[[gem5]]</li></ul><h2 id=다운로드>다운로드</h2><ul><li><a href=https://docs.simplessd.org/en/v2.0.12/instructions/start.html>simplessd 공홈</a></li><li>하라는 대로 하면 된다. (FullSystem은 example 을 실행해도 그대로 안되서, 그냥 standalone 을 먼저 봐보기로 했다.)</li></ul><hr><h2 id=문서-읽기>문서 읽기</h2><ul><li>그냥 홈페이지에 있는 문서를 읽어보자. 중요하니까 정리해놨겠지</li></ul><hr><h3 id=host-interface-layer>Host Interface Layer</h3><ul><li>HIL 이라고도 불리는 Host Interface Layer에 대한 설명이다.</li><li>HIL 은 host side에 있는 host controller, host controller 에게 추상화된 API를 제공해주는 SSD Interface</li></ul><h4 id=host-controller>Host Controller</h4><ul><li>NVMe, SATA and UFS를 구현해 놓았으며, Open-Channel SSD 는 NVMe 를 상속받음.</li></ul><h5 id=host-interface>Host Interface</h5><ul><li><code>hil/nvme/interface.hh</code> 에 <code>SimpleSSD::DMAInterface</code>를 상속하여 선언된 <code>SimpleSSD::HIL::NVMe::Interface</code> 를 보자.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DMAInterface</span> {
 <span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
  DMAInterface() {}
  <span style=color:#66d9ef>virtual</span> <span style=color:#f92672>~</span>DMAInterface() {}

  <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>dmaRead</span>(<span style=color:#66d9ef>uint64_t</span>, <span style=color:#66d9ef>uint64_t</span>, <span style=color:#66d9ef>uint8_t</span> <span style=color:#f92672>*</span>, DMAFunction <span style=color:#f92672>&amp;</span>,
                       <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>dmaWrite</span>(<span style=color:#66d9ef>uint64_t</span>, <span style=color:#66d9ef>uint64_t</span>, <span style=color:#66d9ef>uint8_t</span> <span style=color:#f92672>*</span>, DMAFunction <span style=color:#f92672>&amp;</span>,
                        <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
};
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Interface</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>public</span> SimpleSSD<span style=color:#f92672>::</span>DMAInterface {
 <span style=color:#66d9ef>protected</span><span style=color:#f92672>:</span>
  Controller <span style=color:#f92672>*</span>pController;

 <span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
  <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>void</span> updateInterrupt(<span style=color:#66d9ef>uint16_t</span>, <span style=color:#66d9ef>bool</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>getVendorID</span>(<span style=color:#66d9ef>uint16_t</span> <span style=color:#f92672>&amp;</span>, <span style=color:#66d9ef>uint16_t</span> <span style=color:#f92672>&amp;</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
};
</code></pre></div><ul><li><code>DMAInterface</code> 에서는 Direct Memory Access 를 위해서 <code>dmaRead</code>, <code>dmaWrite</code> 를 제공한다.</li><li><code>updateInterrupt</code> 는 host의 특정 interrupt vector 에 interrupt를 보낸다.</li><li><code>getVendorId</code> 는 NVMe의 <code>Identify Controller</code>가 vendor Id와 subsystem vendor ID를 필요로 하기 때문에 존재하는 method 이다.</li></ul><h5 id=controller-and-firmware>Controller and Firmware</h5><ul><li>NVMe controller/firmware 는 아래 3가지 컴포넌트 (Controller, Subsystem and Namespace)로 구성된다.<ul><li>Controller는 모든 queue 연산(SQ 에서 request 를 읽고, CQ에 request를 쓰고, 인터럽트를 발생시키는)을 담당한다.</li><li>Subsystem은 모든 NVMe의 admin commands를 다루며, Namespace를 제어하고, SSD Layer에 I/O를 실행한다.</li><li>Namespace는 모든 NVMe의 I/O commands 를 다룬다.</li></ul></li></ul><h6 id=controller>Controller</h6><ul><li><p>모든 queue 연산을 담당하는 Controller는 <code>hil/nvme/controller.hh</code>에 <code>SimpleSSD::HIL::NVMe::Controller</code> 로 정의되어 있다.</p></li><li><p><code>EventEngine</code>은 주기적으로 <code>Controller::work</code>를 유발시키며, 이때 주기는 <code>WorkPeriod</code> 설정값을 참조한다.</p></li><li><p><code>Controller::work</code> 는 설정된 중재 함수(<code>Controller::collectSQueue</code>)를 사용하여 모든 submission queue를 모은다.</p></li><li><p>새로운 <code>Request</code>는 내부의 FIFO Queue(<code>Controller::lSQFIFO</code>) 에 넣어지며, 새로운 Request 가 있다면, <code>Controller:handleRequest</code>를 호출해야 한다. 이때 이 함수는 <code>AbstractSubsystem::submitReqeust</code>를 유발한다.</p></li><li><p><code>AbstractSubsystem</code> 이 request를 처리하고 난 뒤, <code>Controller::submit</code> 함수가 불려지게 되며, 내부적으로 존재하는 FIFO Queue(<code>Controller::lCQFIFO</code>)에 완료된 걸 넣는다.</p></li><li><p><code>Controller::submit</code> 함수는 <code>Controller::completion</code> 함수를 부르는 event를 관리한다.</p></li><li><p><code>Controller::completion</code> 함수는 CQ entry를 채우고, <code>Controller::updateInterrupt</code> 를 사용해서 interrupt를 보낸다.</p></li><li><p><code>Controller::updateInterrupt</code>는 단순히 <code>Interface::updateInterrupt</code>를 호출한다.</p></li></ul></div><script>function convertWikiLink(elem){elem.innerHTML=elem.innerHTML.replace(/\[\[(.+?)\]\]\{(.+?)\}/g,(original,matching,display)=>{return `<a href="/wiki/${matching.toLowerCase().replace(/ /g,'-').replace(/[()]/g,'')}">${display}</a>`;});elem.innerHTML=elem.innerHTML.replace(/\[\[(.+?)\]\]/g,(original,matching)=>{var display=matching;if(display==="_index"){display="Front Page";matching="";}
return `<a href="/wiki/${matching.toLowerCase().replace(/ /g,'-').replace(/[()]/g,'')}">${display}</a>`;});};(function(){var content=document.querySelector('.content');convertWikiLink(content);var parent=document.querySelector('.parent-doc');if(parent)convertWikiLink(parent);})();</script><div><script src=https://utteranc.es/client.js repo=makerdark98/makerdark98.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></main><footer><p class="copyright text-muted">© All rights reserved. Powered by <a href=https://gohugo.io>Hugo</a> and <a href=https://github.com/calintat/minimal>Minimal</a>.</p></footer></body></html>