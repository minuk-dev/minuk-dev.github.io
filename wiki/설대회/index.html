<!DOCTYPE html>
<html lang="ko-kr">
    <head>
        

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>설대회</title>
        
        <style>

    html body {
        font-family: 'Raleway', sans-serif;
        background-color: white;
    }

    :root {
        --accent: #00a3d2;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="/css/main.css">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">


 

<link rel="stylesheet" href="/vendor/highlight/styles/default.css">




<link rel="stylesheet" href="/vendor/bootstrap-3.3.7-dist/css/bootstrap.min.css">


<link rel="stylesheet" href="/vendor/font-awesome-4.7.0/css/font-awesome.min.css">
 


    <script src="/vendor/highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>







<script src="/vendor/jquery-3.4.1.min.js"></script>



<script src="/vendor/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>

<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>

        

        

        
            
          <script type="text/javascript" async src="/vendor/MathJax-2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        

        

        <meta name="google-site-verification" content="g_3tJyj-KkW-_wKx7Ij5GimHV1nKPZXetCz8ydbBAfA" />

    </head>

    <body>
        

        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand visible-xs" href="#">설대회</a>
                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse">
                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/">Home</a></li>
                            
                                <li><a href="/wiki/">Wiki</a></li>
                            
                                <li><a href="/posts/">Posts</a></li>
                            
                                <li><a href="/projects/">Projects</a></li>
                            
                                <li><a href="/about/">About</a></li>
                            
                        </ul>
                    
                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="mailto:makerdark98@gmail.com"><i class="fa fa-envelope-o"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://github.com/makerdark98/"><i class="fa fa-github"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://twitter.com/makerdark98/"><i class="fa fa-twitter"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.linkedin.com/in/makerdark98/"><i class="fa fa-linkedin"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.stackoverflow.com/makerdark98/"><i class="fa fa-stack-overflow"></i></a></li>
                            
                            <li>
                              <div style="max-width:300px;display:inline-block;max-height:40px;">
                                <script async src="https://cse.google.com/cse.js?cx=003491619885022567520:wnnypdnx4aj"></script>
<div class="gcse-search"></div>

                              </div>
                            </li>
                        </ul>
                    
                </div>
            </div>
        </nav>


<main>

    <div style="text-align:left;">
      <button class="btn btn-link" onclick="history.back();"><i class="fa fa-arrow-left"></i>&nbsp;뒤로 가기 </button>
    </div>
    <div>
        <h2>설대회</h2>
        <a href="https://github.com/makerdark98/makerdark98.github.io/blame/master/src/content/wiki/%ec%84%a4%eb%8c%80%ed%9a%8c.md">
  <h5>created : Sun, 26 Jan 2020 23:57:47 &#43;0900</h5>
  <h5>modified : Wed, 08 Apr 2020 22:49:16 &#43;0900</h5>
</a>

        

    </div>

    <aside class="navbar" id="nav-toc" style="text-align:left;"><nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#1-생각의-흐름">1. 생각의 흐름</a>
<ul>
<li><a href="#과연-설은-무엇일까">과연 설은 무엇일까?</a></li>
<li><a href="#깨달음">깨달음</a></li>
</ul></li>
<li><a href="#2-구체화">2. 구체화</a>
<ul>
<li><a href="#반전">반전!</a></li>
<li><a href="#2-1-크롤링-구현">2-1. 크롤링 구현</a></li>
<li><a href="#2-2-전처리">2-2. 전처리</a></li>
<li><a href="#2-3-시각화">2-3. 시각화</a></li>
<li><a href="#나중에야-정리-2020-04-07">나중에야 정리 (2020-04-07)</a></li>
</ul></li>
<li><a href="#결과-이미지">결과 이미지</a></li>
</ul></li>
</ul>
</nav></aside>
    <div align="start" class="content" data-spy="scroll" data-offset="20" data-target="#nav-toc" style="position:relative;">
      

<h2 id="1-생각의-흐름">1. 생각의 흐름</h2>

<ul>
<li>설 대회로는 <code>설</code> 그 자체를 표현하라고 했다.</li>
<li>사실 원래 계획은 Word2Vec를 통해서 <code>9월 (혹은 10월) : 추석 = 1월 (혹은 2월) : 설</code> 이라던가 송편과 떡국 간의 관계를 통해서 설이라는 단어를 결과값으로 뽑고 싶었다.</li>
<li>체계단 내에서 누군가가 konlpy로 무언가를 하고 있는 것을 봤다. NLP라는 영역이 겹치는 것 같아서 뭔가 아이디어가 겹친다고 생각되어 처음부터 다시 생각하기로 했다.</li>
<li></li>
</ul>

<h3 id="과연-설은-무엇일까">과연 설은 무엇일까?</h3>

<ul>
<li>구글 번역기에 영어로 돌려봤다. New Year&rsquo;s Day라고 나온다.</li>
<li>New Yera&rsquo;s Day라고 검색하니 별로 안나왔다.</li>
<li>중국어로 춘절이라고 해서 검색해보니 중국 코로나 바이러스 사태 기사만 나온다.</li>
<li>별 도움이 되지 않았다 ㅠ</li>
</ul>

<h3 id="깨달음">깨달음</h3>

<ul>
<li>아! 아무도 설에 대해서 모르는구나. 모두 설을 뭐라고 생각할까 알아보기로 했다.</li>
<li>그렇다면 설은 어떻게 표현될까?</li>
<li>잘 모르겠다. 설 당일 사람들이 검색하는게 곧 설이지 않을까라는 생각에 도달했다.</li>
</ul>

<h2 id="2-구체화">2. 구체화</h2>

<ul>
<li>아이디어는 다음과 같다.</li>
<li>설 당일 네이버 실시간 검색을 1분 단위로 저장해논다.</li>
<li>이를 가공해서 사람들에게 보여주자! 그게 곧 설아니겠는가?</li>
</ul>

<h3 id="반전">반전!</h3>

<ul>
<li>사실 설이 일요일인줄 알고 토요일날 코딩해도 널널하겠네 라고 생각했는데 설이 알고보니 토요일이였다.</li>
<li>이걸 깨달은건 토요일 아침 7시이다.</li>
<li>이미 늦었다. 젠장OTL.</li>
<li>생각해낸 아이디어는 시간이 제일 중요하다. 실시간 검색어를 바로 모으기로 했다.</li>
<li>그래서 아침 8시부터 저녁 10시까지 1분 간격으로 크롤링했다.</li>
</ul>

<h3 id="2-1-크롤링-구현">2-1. 크롤링 구현</h3>

<pre><code class="language-js">  var request = require (&quot;request&quot;);
  var fs = require(&quot;fs&quot;);
  request.get({url : &quot;https://m.search.naver.com/search.naver?sm=mtp_sug.top&amp;where=m&amp;query=%EC%8B%A4%EC%8B%9C%EA%B0%84%EA%B2%80%EC%83%89%EC%96%B4&amp;acq=%EC%8B%A8&amp;acr=0&amp;qdt=0&quot; }, function (err, response, body){
  	fs.writeFileSync(&quot;&quot;+Date.now(), body);
  });
</code></pre>

<ul>
<li>사실 별거 없다. 1분만에 짠 코드답다. 뭔가 처리하지도 않고 그냥 데이터를 저장만 한다.</li>
<li>이걸 1분마다 실행해야 된다. node 로 해도 되는데, 먼가 에러 처리를 하나도 안해놔서 속된말로 쫄렸다.</li>
<li>그래서 뭔가 에러나도 별 상관 없이 프로세스가 안죽었으면 했다.</li>

<li><p>걍 프로세스가 죽어도 냅두기로 했다. 걍 1분마다 재실행 하는게 더 빠르겠더라.</p>

<p>crontab -e</p></li>
</ul>

<p>를 열어서 1분마다 위 코드를 실행하기로 했다.</p>

<p>[]()</p>

<p>그렇게 서버에 14시간 정도 방치해놨다.</p>

<h3 id="2-2-전처리">2-2. 전처리</h3>

<ul>
<li>역시 전체를 걍 저장하니 용량이 어마어마했다. 400MB나 됬다.</li>
<li>이제 전체 검색 결과가 아니라, 실시간 검색어만 빼보자(사실 이렇게 하면 5MB 이내일듯)</li>
<li>지금 시간 새벽 1시 5분 이제 전처리 시작한다 ㅠ</li>
<li>1시간 정도 짯다 ㅠ 오프라인 극혐&hellip; node_modules를 까서 사용법을 읽어본 다음 짜려고 하니 너무 오래걸린다.</li>
</ul>

<pre><code class="language-js">  const fs = require('fs');
  const cheerio = require('cheerio');
  
  fs.readdir('./raw_data', (err, files) =&gt; {
    if (err)
      throw err;
    const data = files.map((filename) =&gt; {
      const body = fs.readFileSync(`./raw_data/${filename}`);
      const $ = cheerio.load(body);
      const keywords = $('._keyword');
      let retval = '';
      for (let i = 0, length = keywords.length;
        i &lt; length;
        i += 1) {
        retval += keywords[i].children[0].data + ',';
      }
      return retval;
    }).reduce((retval, now) =&gt; retval+='\n'+now);
    
    fs.writeFileSync('data.csv', data);
  });
</code></pre>

<p>데이터를 읽어서 오름차순의 형태로 1줄이 1분을 나타내도록 저장한다.</p>

<ul>
<li>결과적으론 1MB 짜리 파일이 하나 나왔다.</li>
</ul>

<h3 id="2-3-시각화">2-3. 시각화</h3>

<ul>
<li>실제로 수치를 분석해서 우리가 상품을 제작할것도 아니고 대충 어떤 키워드들이 있는지 알아보기 위한거니 WordCloud를 시각화 도구로 사용하기로 했다.</li>
<li>WordCloud는 D3를 이용해서 만들껀데 지금 오프라인이라 파일을 다운 받을 방법이 없으니 일단은 여기까지- 현재시각 2시 15분 - (어휴 이정도면 많이 했다.)</li>
<li>현재 시각 13시 5분, 방금 일어났다. 이제 시각화를 해보자</li>
</ul>

<h3 id="나중에야-정리-2020-04-07">나중에야 정리 (2020-04-07)</h3>

<ul>
<li>http-server module을 설치해서 간단한 web-server를 연다.</li>
<li>안그러면 csv파일 형식을 못연다.</li>
<li>output.html
<code>html
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;script src=&quot;./d3.min.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;./d3.layout.cloud.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;./wordcloud.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></li>
<li>wordcloud.js
```js
const width = 2080, height = 1920;
const svg = d3.select(&ldquo;body&rdquo;).append(&ldquo;svg&rdquo;)
.attr(&ldquo;width&rdquo;, width)
.attr(&ldquo;height&rdquo;, height);
d3.csv(&ldquo;worddata.csv&rdquo;).
then(function (data) {
showCloud(data)
setInterval(function() {
showCloud(data);
}, 10000);
});</li>
</ul>

<p>wordScale = d3.scaleLinear().domain([0, 100]).range([0, 150]).clamp(true);</p>

<p>svg.append(&ldquo;g&rdquo;).attr(&ldquo;transform&rdquo;, &ldquo;translate(&rdquo; + width * 2 + &ldquo;,&rdquo; + height +&ldquo;)&rdquo;);</p>

<p>function showCloud(data) {
  d3.layout.cloud().size([width, height])
    .words(data)
    .rotate(function(d) {
      return d.text.length &gt; 3 ? 0 : 90;
    })
    .font(&ldquo;Impact&rdquo;)
    .fontSize(function (d) {
      return wordScale(d.frequency);
    })
    .on(&ldquo;end&rdquo;, draw)
    .start();
  function draw(words) {
    var cloud = svg.selectAll(&ldquo;text&rdquo;).data(words)</p>

<pre><code>cloud.enter()
  .append(&quot;text&quot;)
  .style(&quot;fill&quot;, &quot;#4052&quot;)
  .attr(&quot;text-anchor&quot;, &quot;middle&quot;)
  .style(&quot;font-size&quot;, function (d) {
    return d.size + &quot;px&quot;;
  })
//.attr(&quot;font-size&quot;, 1)
  .text(function (d) {
    return d.text;
  });

cloud
  .transition()
  .duration(600)
  .style(&quot;font-size&quot;, function (d) {
    return d.size + &quot;px&quot;;
  }).attr(&quot;transform&quot;, function (d) {
    return `translate(${d.x+width/2}, ${d.y+height/2})rotate(${d.rotate})`
}).style(&quot;fill-opacity&quot;, 1);
</code></pre>

<p>}
}
```</p>

<h2 id="결과-이미지">결과 이미지</h2>

<ul>
<li><img src="/wiki/images/new_year.png" alt="" /></li>
<li>생각만큼 잘 나오지 않았다.</li>
<li>그리고 급하게 하느라고 그때 데이터가 아니라 다른 데이터로 그림을 만들었다.</li>
</ul>

    </div>

  <script>
      ;(function() {
              var content = document.querySelector('.content');
        content.innerHTML = content.innerHTML.replace(/\[\[(.+?)\]\]\{(.+?)\}/g, (original, matching, display) => {
          console.log(matching, display);
          return `<a href="/wiki/${matching.toLowerCase().replace(/ /g, '-').replace(/[()]/g, '')}">${display}</a>`;
        });
        content.innerHTML = content.innerHTML.replace(/\[\[(.+?)\]\]/g, (original, matching) =>
          `<a href="/wiki/${matching.toLowerCase().replace(/ /g, '-').replace(/[()]/g, '')}">${matching}</a>`);
      })();
</script>

  <div style="min-width:500px;">
<script src="https://utteranc.es/client.js"
        repo="makerdark98/makerdark98.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>

</main>
        <footer>
            <p class="copyright text-muted">&copy; All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a>.</p>
        </footer>

        

        
    </body>

</html>

