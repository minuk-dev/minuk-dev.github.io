<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Storage Engine on</title><link>https://minuk.dev/tags/storage-engine/</link><description>Recent content in Storage Engine on</description><generator>Hugo</generator><language>ko-kr</language><lastBuildDate>Sat, 26 Mar 2022 03:44:02 +0900</lastBuildDate><atom:link href="https://minuk.dev/tags/storage-engine/index.xml" rel="self" type="application/rss+xml"/><item><title>mysql (storage engine)</title><link>https://minuk.dev/wiki/mysql/</link><pubDate>Thu, 28 May 2020 07:48:47 +0900</pubDate><guid>https://minuk.dev/wiki/mysql/</guid><description>&lt;h1 id="참고용-홈페이지">참고용 홈페이지&lt;/h1>
&lt;ol>
&lt;li>&lt;a href="https://dev.mysql.com/doc/internals/en/custom-engine.html">https://dev.mysql.com/doc/internals/en/custom-engine.html&lt;/a>&lt;/li>
&lt;li>mysql architecture&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;img src="https://minuk.dev/wiki/images/mysql_architecture.png" alt="mysql architecture">&lt;/li>
&lt;/ul>
&lt;ol start="3">
&lt;li>&lt;a href="https://dev.mysql.com/doc/dev/mysql-server/latest/PAGE_PFS_PSI.html">https://dev.mysql.com/doc/dev/mysql-server/latest/PAGE_PFS_PSI.html&lt;/a>&lt;/li>
&lt;/ol>
&lt;h2 id="환경-설정">환경 설정&lt;/h2>
&lt;ul>
&lt;li>일단 지금 집에다가 예전에 썻던 삼성 노트북을 wol 으로 설정하고 (완전히 꺼지면 안켜지니까 shutdown 을 alias 해놓고, suspend를 사용하는 식으로 했다.휴가 때 마다 혹은 가끔씩 reboot 해주면 되겠지?)&lt;/li>
&lt;li>github 에서 다운로드 해서 private repository 에다가 올려놨다.&lt;/li>
&lt;/ul>







&lt;div class="codeblock">
 
 &lt;div class="copy-button-box">
 &lt;button class="copy-button" state="copy" data="#ZgotmplZ">
 &lt;i class="bi bi-copy">&lt;/i>
 &lt;/button>
 &lt;/div>
 

 
 &lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ git clone https://github.com/mysql/mysql-server&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
 
&lt;/div>
&lt;ul>
&lt;li>참고용 홈페이지 1을 보면 알 수 있듯이 &lt;code>storage/example&lt;/code> 을 똑같이 카피했다.&lt;/li>
&lt;li>일단 지금 목표는 custom engine 을 만들어 보는 거고 가능하다면 2018년 FAST 에 나온 논문인 FAST_PAIR 를 만들어보는거다.&lt;/li>
&lt;li>일단 공부한 내용을 아래에 써놓겠다.&lt;/li>
&lt;/ul>
&lt;h2 id="겪었던-문제들">겪었던 문제들&lt;/h2>
&lt;ul>
&lt;li>git push 를 할때 너무 많아서 그런지 안올라가진다. -&amp;gt; 브랜치를 나눠서 올리면 된다. mysql 8.0.0 까진 수월하게 올라간다. mysql-8.0.0 브랜치까지 올리고 나머지 올리면 올라가진다. 용량이 커서 안올라가지는 것 같다.&lt;/li>
&lt;/ul>
&lt;h2 id="코딩할-때-알아야할-내용">코딩할 때 알아야할 내용&lt;/h2>
&lt;h3 id="mysysh-관련">mysys.h 관련&lt;/h3>
&lt;ol>
&lt;li>&lt;code>include/mysys.h&lt;/code> 에 사용할만한 함수들이 많이 정리되어 있다.&lt;/li>
&lt;li>File 관련 : &lt;code>my_create&lt;/code>, &lt;code>my_close&lt;/code>&lt;/li>
&lt;li>문자열 관련 : &lt;code>fn_format&lt;/code> (filename format) - &lt;code>to&lt;/code>(buffer variable), &lt;code>name&lt;/code>, &lt;code>dir&lt;/code>, &lt;code>extension&lt;/code>, &lt;code>flags&lt;/code> 순서&lt;/li>
&lt;li>Memory 관련 : &lt;code>my_malloc&lt;/code>, &lt;code>my_free&lt;/code>&lt;/li>
&lt;/ol>
&lt;h3 id="thd-mysql-thread-객체-관련">THD (mysql thread 객체) 관련&lt;/h3>
&lt;ol>
&lt;li>mysql thread 객체 (&lt;code>THD&lt;/code>) 에 변수로 넣으면 (&lt;code>THDVAR_SET&lt;/code>) 복사가 일어난다. (추측) -&amp;gt; 따라서 넣어야할 값이 있으면 my_malloc 하고 넣은다음에 my_free 해줘야한다. (Memory Leak 나지 않게 조심하자!)&lt;/li>
&lt;li>Mysql Thread 객체 (THD)에 값 확인, 넣기 : &lt;code>THDVAR(대상 Thread, 원하는 변수명)&lt;/code>, &lt;code>THDVAR_SET(대상 Thread, 원하는 변수명, 값의 주소)&lt;/code>&lt;/li>
&lt;/ol>
&lt;h3 id="debug">Debug&lt;/h3>
&lt;ol>
&lt;li>Debug를 위해서 return 같은거 할때 &lt;code>DBUG_RETURN&lt;/code> 을 적극적으로 활용하자&lt;/li>
&lt;/ol>
&lt;h1 id="참고용-홈페이지-읽고-정리하기">참고용 홈페이지 읽고 정리하기&lt;/h1>
&lt;h3 id="232-overview">23.2 Overview&lt;/h3>
&lt;ul>
&lt;li>&lt;code>handler&lt;/code>라는 interface를 구현하도록 되어 있는데, 각 connection 마다 thread가 생성되고 각 thread마다 handler instance를 생성하고 가지고 있도록 한다.
&lt;ul>
&lt;li>질문점 : 그러면 각 handler들이 같은 table에 접근하게 되면 어떻게 되나 : handler를 구현할때 알아서 해결해야 한다. 가장 단순한 해결법은 table마다 lock을 가지게 해서 동시에 handler들이 접근 못하도록 하는것. (생각해보면 read lock, write lock마다 구현법도 다양하고 mvcc같은거 고려하면 생각할게 너무 많을 텐데 당연하게도 storage engine이 알아서 처리하도록 하는게 맞다)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>read-only -&amp;gt; insert, update, delete -&amp;gt; indexing, transactions -&amp;gt; other advanced options 순서로 구현하라고 한다.&lt;/li>
&lt;/ul>
&lt;h3 id="233-creating-storage-engine-source-files">23.3 Creating Storage Engine Source Files&lt;/h3>
&lt;ul>
&lt;li>&lt;code>example&lt;/code> 을 복사해서 수정하는게 제일 단순하다 (사실 이렇게 공식 홈페이지 적어놓을만 한게, innobase(=innodb)코드를 보고 비슷하게 만들어보려고 시도했는데, 나에게는 이건 너무 어려웠다. ㅠ)&lt;/li>
&lt;/ul>
&lt;h3 id="234-adding-engine-specific-variables-and-parameters">23.4 Adding Engine Specific Variables and Parameters&lt;/h3>
&lt;ul>
&lt;li>구조가 Plugin 식으로 추가되는 식인것 같은데 그래서 Plugin 을 만드는 방법에 대해서 나와있다.&lt;/li>
&lt;li>이걸 열심히 공부하는것도 맞지만, 조금 목표와 멀어질 것 같아서 일단은 innobase 꺼 CMakeLists.txt 를 참고했고, 나중에 필요하면 다시 보면 될거라고 생각한다.&lt;/li>
&lt;/ul>
&lt;h3 id="235-creating-the-handlerton">23.5 Creating the handlerton&lt;/h3>
&lt;ul>
&lt;li>&lt;code>handlerton&lt;/code> (= handler singleton) : storage engine 마다 1개씩 있는 객체로, transaction을 다루는 commit, rollbacks 같은 기능을 제공하게 된다.&lt;/li>
&lt;/ul>







&lt;div class="codeblock">
 
 &lt;div class="copy-button-box">
 &lt;button class="copy-button" state="copy" data="typedef%20struct%0a%20%20%7b%0a%20%20%20%20const%20char%20*name;%20/*%20storage%20engine%20%ec%9d%98%20%ec%9d%b4%eb%a6%84%20:%20CREATE%20TABLE%20...%20ENGINE=FOO;%20%ec%97%90%20%ec%93%b0%ec%9d%b8%eb%8b%a4.%20*/%0a%20%20%20%20SHOW_COMP_OPTION%20state;%20/*%20SHOW%20STORAGE%20ENGINES%20command%eb%a5%bc%20%ec%82%ac%ec%9a%a9%ed%95%98%eb%a9%b4%20%ec%b6%9c%eb%a0%a5%eb%90%98%eb%8a%94%20%ea%b0%92%20*/%0a%20%20%20%20const%20char%20*comment;%20/*%20SHOW%20%20STORAGE%20ENGINES%20command%eb%a5%bc%20%ec%82%ac%ec%9a%a9%ed%95%a0%eb%95%8c%20%ec%b6%9c%eb%a0%a5%eb%90%98%eb%8a%94%20%ec%84%a4%eb%aa%85%20*/%0a%20%20%20%20enum%20db_type%20db_type;%20/*%20custom%20engine%20%ec%9d%80%20%eb%b0%98%eb%93%9c%ec%8b%9c%20DB_TYPE_UNKNOWN%20%ec%9d%84%20%ec%82%ac%ec%9a%a9%ed%95%b4%ec%95%bc%ed%95%9c%eb%8b%a4%ea%b3%a0%20%ed%95%a9%eb%8b%88%eb%8b%a4.%20*/%0a%20%20%20%20bool%20%28*init%29%28%29;%20/*%20Server%20%ea%b0%80%20%ec%8b%9c%ec%9e%91%ed%95%a0%eb%95%8c%20%eb%94%b1%201%eb%b2%88%20%eb%b6%88%eb%a6%ac%ea%b2%8c%20%eb%90%98%ea%b3%a0,%20handler%ea%b0%80%20instance%20%ed%99%94%20%eb%90%98%ea%b8%b0%20%ec%a0%84%ec%97%90%20%ec%b2%98%eb%a6%ac%eb%90%98%ec%95%bc%ed%95%a0%20%eb%82%b4%ec%9a%a9%ec%9d%84%20%eb%84%a3%ec%9c%bc%eb%a9%b4%eb%90%9c%eb%8b%a4.%20*/%0a%20%20%20%20uint%20slot;%20/*%20storage%20engine%20%eb%a7%88%eb%8b%a4%20%ea%b3%a0%ec%9c%a0%ed%95%98%ea%b2%8c%20%ea%b0%80%ec%a7%80%ea%b3%a0%ec%9e%88%eb%8a%94%20%eb%a9%94%eb%aa%a8%eb%a6%ac%20%ec%98%81%ec%97%ad%20thd-%3eha_data[foo_hton.slot]%ec%9c%bc%eb%a1%9c%20%ec%a0%91%ea%b7%bc%ea%b0%80%eb%8a%a5%ed%95%98%ea%b3%a0,%20Rollback%20%ea%b5%ac%ed%98%84%ed%95%a0%eb%96%84%20%ec%b0%b8%ec%a1%b0%ed%95%98%eb%9d%bc%ea%b3%a0%20%ec%a0%81%ed%98%80%ec%9e%88%ec%9d%8c%20*/%0a%20%20%20%20uint%20savepoint_offset;%20/*%20savepoint%20%ec%9d%98%20%ec%9c%84%ec%b9%98,%200%ec%9d%b4%eb%a9%b4%20savepoint%20memory%ea%b0%80%20%ed%95%84%ec%9a%94%ed%95%98%ec%a7%80%20%ec%95%8a%eb%8b%a4.%20*/%0a%20%20%20%20int%20%20%28*close_connection%29%28THD%20*thd%29;%0a%20%20%20%20int%20%20%28*savepoint_set%29%28THD%20*thd,%20void%20*sv%29;%0a%20%20%20%20int%20%20%28*savepoint_rollback%29%28THD%20*thd,%20void%20*sv%29;%0a%20%20%20%20int%20%20%28*savepoint_release%29%28THD%20*thd,%20void%20*sv%29;%0a%20%20%20%20int%20%20%28*commit%29%28THD%20*thd,%20bool%20all%29;%0a%20%20%20%20int%20%20%28*rollback%29%28THD%20*thd,%20bool%20all%29;%0a%20%20%20%20int%20%20%28*prepare%29%28THD%20*thd,%20bool%20all%29;%0a%20%20%20%20int%20%20%28*recover%29%28XID%20*xid_list,%20uint%20len%29;%0a%20%20%20%20int%20%20%28*commit_by_xid%29%28XID%20*xid%29;%0a%20%20%20%20int%20%20%28*rollback_by_xid%29%28XID%20*xid%29;%0a%20%20%20%20void%20*%28*create_cursor_read_view%29%28%29;%0a%20%20%20%20void%20%28*set_cursor_read_view%29%28void%20*%29;%0a%20%20%20%20void%20%28*close_cursor_read_view%29%28void%20*%29;%0a%20%20%20%20handler%20*%28*create%29%28TABLE%20*table%29;%0a%20%20%20%20void%20%28*drop_database%29%28char*%20path%29;%0a%20%20%20%20int%20%28*panic%29%28enum%20ha_panic_function%20flag%29;%0a%20%20%20%20int%20%28*release_temporary_latches%29%28THD%20*thd%29;%0a%20%20%20%20int%20%28*update_statistics%29%28%29;%0a%20%20%20%20int%20%28*start_consistent_snapshot%29%28THD%20*thd%29;%0a%20%20%20%20bool%20%28*flush_logs%29%28%29;%0a%20%20%20%20bool%20%28*show_status%29%28THD%20*thd,%20stat_print_fn%20*print,%20enum%20ha_stat_type%20stat%29;%0a%20%20%20%20int%20%28*repl_report_sent_binlog%29%28THD%20*thd,%20char%20*log_file_name,%20my_off_t%20end_offset%29;%0a%20%20%20%20uint32%20flags;%0a%20%20%7d%20handlerton;">
 &lt;i class="bi bi-copy">&lt;/i>
 &lt;/button>
 &lt;/div>
 

 
 &lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>name; &lt;span style="color:#75715e">/* storage engine 의 이름 : CREATE TABLE ... ENGINE=FOO; 에 쓰인다. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SHOW_COMP_OPTION state; &lt;span style="color:#75715e">/* SHOW STORAGE ENGINES command를 사용하면 출력되는 값 */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>comment; &lt;span style="color:#75715e">/* SHOW STORAGE ENGINES command를 사용할때 출력되는 설명 */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">db_type&lt;/span> db_type; &lt;span style="color:#75715e">/* custom engine 은 반드시 DB_TYPE_UNKNOWN 을 사용해야한다고 합니다. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>init)(); &lt;span style="color:#75715e">/* Server 가 시작할때 딱 1번 불리게 되고, handler가 instance 화 되기 전에 처리되야할 내용을 넣으면된다. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uint slot; &lt;span style="color:#75715e">/* storage engine 마다 고유하게 가지고있는 메모리 영역 thd-&amp;gt;ha_data[foo_hton.slot]으로 접근가능하고, Rollback 구현할떄 참조하라고 적혀있음 */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uint savepoint_offset; &lt;span style="color:#75715e">/* savepoint 의 위치, 0이면 savepoint memory가 필요하지 않다. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>close_connection)(THD &lt;span style="color:#f92672">*&lt;/span>thd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>savepoint_set)(THD &lt;span style="color:#f92672">*&lt;/span>thd, &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>sv);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>savepoint_rollback)(THD &lt;span style="color:#f92672">*&lt;/span>thd, &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>sv);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>savepoint_release)(THD &lt;span style="color:#f92672">*&lt;/span>thd, &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>sv);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>commit)(THD &lt;span style="color:#f92672">*&lt;/span>thd, &lt;span style="color:#66d9ef">bool&lt;/span> all);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>rollback)(THD &lt;span style="color:#f92672">*&lt;/span>thd, &lt;span style="color:#66d9ef">bool&lt;/span> all);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>prepare)(THD &lt;span style="color:#f92672">*&lt;/span>thd, &lt;span style="color:#66d9ef">bool&lt;/span> all);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>recover)(XID &lt;span style="color:#f92672">*&lt;/span>xid_list, uint len);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>commit_by_xid)(XID &lt;span style="color:#f92672">*&lt;/span>xid);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>rollback_by_xid)(XID &lt;span style="color:#f92672">*&lt;/span>xid);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#f92672">*&lt;/span>create_cursor_read_view)();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>set_cursor_read_view)(&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>close_cursor_read_view)(&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#f92672">*&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> handler &lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#f92672">*&lt;/span>create)(TABLE &lt;span style="color:#f92672">*&lt;/span>table);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">void&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>drop_database)(&lt;span style="color:#66d9ef">char&lt;/span>&lt;span style="color:#f92672">*&lt;/span> path);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>panic)(&lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">ha_panic_function&lt;/span> flag);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>release_temporary_latches)(THD &lt;span style="color:#f92672">*&lt;/span>thd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>update_statistics)();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>start_consistent_snapshot)(THD &lt;span style="color:#f92672">*&lt;/span>thd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>flush_logs)();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>show_status)(THD &lt;span style="color:#f92672">*&lt;/span>thd, stat_print_fn &lt;span style="color:#f92672">*&lt;/span>print, &lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">ha_stat_type&lt;/span> stat);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>repl_report_sent_binlog)(THD &lt;span style="color:#f92672">*&lt;/span>thd, &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>log_file_name, my_off_t end_offset);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uint32 flags;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } handlerton;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
 
&lt;/div>
&lt;ul>
&lt;li>적다보니 아래 부분은 transcation 을 구현할때나 필요한 부분이라 나중에 생각하기로 했다. 대충 공식 메뉴얼정도만 읽었고 굳이 번역해놓을 필요는 없을듯?&lt;/li>
&lt;/ul>
&lt;h3 id="236-handling-handler-instantiation">23.6 Handling Handler Instantiation&lt;/h3>







&lt;div class="codeblock">
 
 &lt;div class="copy-button-box">
 &lt;button class="copy-button" state="copy" data="static%20handler*%20example_create_handler%20%28TABLE*%20table%29;">
 &lt;i class="bi bi-copy">&lt;/i>
 &lt;/button>
 &lt;/div>
 

 
 &lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">static&lt;/span> handler&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#a6e22e">example_create_handler&lt;/span> (TABLE&lt;span style="color:#f92672">*&lt;/span> table);&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
 
&lt;/div>
&lt;ul>
&lt;li>handler 생성 함수를 만들어야된다.&lt;/li>
&lt;li>handler constructor를 단순히 호출하는 형식으로 구현할 수도 있다. (아래 예시는 myisam 의 구현)&lt;/li>
&lt;/ul>







&lt;div class="codeblock">
 
 &lt;div class="copy-button-box">
 &lt;button class="copy-button" state="copy" data="static%20handler%20*myisam_create_handler%28TABLE%20*table%29%0a%20%20%7b%0a%20%20%20%20return%20new%20ha_myisam%28table%29;%0a%20%20%7d">
 &lt;i class="bi bi-copy">&lt;/i>
 &lt;/button>
 &lt;/div>
 

 
 &lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">static&lt;/span> handler &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">myisam_create_handler&lt;/span>(TABLE &lt;span style="color:#f92672">*&lt;/span>table)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ha_myisam(table);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
 
&lt;/div>
&lt;ul>
&lt;li>constructor 의 구현 예시&lt;/li>
&lt;/ul>







&lt;div class="codeblock">
 
 &lt;div class="copy-button-box">
 &lt;button class="copy-button" state="copy" data="#ZgotmplZ">
 &lt;i class="bi bi-copy">&lt;/i>
 &lt;/button>
 &lt;/div>
 

 
 &lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>ha_federated&lt;span style="color:#f92672">::&lt;/span>ha_federated(TABLE &lt;span style="color:#f92672">*&lt;/span>table_arg)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">:&lt;/span>handler(&lt;span style="color:#f92672">&amp;amp;&lt;/span>federated_hton, table_arg),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mysql(&lt;span style="color:#ae81ff">0&lt;/span>), stored_result(&lt;span style="color:#ae81ff">0&lt;/span>), scan_flag(&lt;span style="color:#ae81ff">0&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ref_length(&lt;span style="color:#66d9ef">sizeof&lt;/span>(MYSQL_ROW_OFFSET)), current_position(&lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
 
&lt;/div>
&lt;h3 id="237-defining-filename-extensions">23.7 Defining Filename Extensions&lt;/h3>
&lt;ul>
&lt;li>지원하는 확장자를 &lt;code>const char* []&lt;/code> 로 넘기면 처리해준다&lt;/li>
&lt;li>단 array 의 마지막 은 &lt;code>NullS&lt;/code> 로 끝나야함.&lt;/li>
&lt;li>아래 코드는 csv 예시&lt;/li>
&lt;/ul>







&lt;div class="codeblock">
 
 &lt;div class="copy-button-box">
 &lt;button class="copy-button" state="copy" data="static%20const%20char%20*ha_tina_exts[]%20=%20%7b%0a%20%20%22.CSV%22,%0a%20%20NullS%0a%7d;">
 &lt;i class="bi bi-copy">&lt;/i>
 &lt;/button>
 &lt;/div>
 

 
 &lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>ha_tina_exts[] &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;.CSV&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> NullS
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
 
&lt;/div>
&lt;ul>
&lt;li>이렇게 정의된 array를 다음과 같이 설정해주면 됨.&lt;/li>
&lt;/ul>







&lt;div class="codeblock">
 
 &lt;div class="copy-button-box">
 &lt;button class="copy-button" state="copy" data="#ZgotmplZ">
 &lt;i class="bi bi-copy">&lt;/i>
 &lt;/button>
 &lt;/div>
 

 
 &lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">**&lt;/span>ha_tina&lt;span style="color:#f92672">::&lt;/span>bas_ext() &lt;span style="color:#66d9ef">const&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ha_tina_exts;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
 
&lt;/div>
&lt;ul>
&lt;li>&lt;code>DROP TABLE&lt;/code> 에서 table을 지웠을 때 파일이 삭제되는 기능을 딱히 구현하지 않고 생략해도 된다.&lt;/li>
&lt;li>근데 이건 필수가 아닌 건지, &lt;code>handler&lt;/code> class에 따로 선언되어 있지는 않다. -&amp;gt; 직접 구현했는데 혹시 문제가 생길수도 있으니 메모해놓는다.&lt;/li>
&lt;/ul>
&lt;h3 id="238-creating-tables">23.8 Creating Tables&lt;/h3>







&lt;div class="codeblock">
 
 &lt;div class="copy-button-box">
 &lt;button class="copy-button" state="copy" data="virtual%20int%20create%28const%20char%20*name,%20TABLE%20*form,%20HA_CREATE_INFO%20*info%29=0;">
 &lt;i class="bi bi-copy">&lt;/i>
 &lt;/button>
 &lt;/div>
 

 
 &lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">create&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>name, TABLE &lt;span style="color:#f92672">*&lt;/span>form, HA_CREATE_INFO &lt;span style="color:#f92672">*&lt;/span>info)&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
 
&lt;/div>
&lt;ul>
&lt;li>위 함수를 반드시 구현하라고 한다.&lt;/li>
&lt;li>&lt;code>name&lt;/code> 은 &lt;code>table&lt;/code>의 이름&lt;/li>
&lt;li>&lt;code>form&lt;/code> 은 &lt;code>tablename&lt;/code> 이랑 매칭되는 &lt;code>TABLE&lt;/code> structure : &lt;code>tablename.frm&lt;/code> 이라는 파일에 이미 다 만들어 놨으니, Storage Engine은 이를 변경하면 안됨.&lt;/li>
&lt;li>&lt;code>info&lt;/code> 는 &lt;code>CREATE TABLE&lt;/code>을 했을 때 생기는 정보. &lt;code>handler.h&lt;/code>에 정의 되어 있으니 참조.&lt;/li>
&lt;/ul>







&lt;div class="codeblock">
 
 &lt;div class="copy-button-box">
 &lt;button class="copy-button" state="copy" data="typedef%20struct%20st_ha_create_information%0a%7b%0a%20%20%20%20CHARSET_INFO%20*table_charset,%20*default_table_charset;%0a%20%20%20%20LEX_STRING%20connect_string;%0a%20%20%20%20const%20char%20*comment,*password;%0a%20%20%20%20const%20char%20*data_file_name,%20*index_file_name;%0a%20%20%20%20const%20char%20*alias;%0a%20%20%20%20ulonglong%20max_rows,min_rows;%0a%20%20%20%20ulonglong%20auto_increment_value;%0a%20%20%20%20ulong%20table_options;%0a%20%20%20%20ulong%20avg_row_length;%0a%20%20%20%20ulong%20raid_chunksize;%0a%20%20%20%20ulong%20used_fields;%0a%20%20%20%20SQL_LIST%20merge_list;%0a%20%20%20%20enum%20db_type%20db_type;%0a%20%20%20%20enum%20row_type%20row_type;%0a%20%20%20%20uint%20null_bits;%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20/*%20NULL%20bits%20at%20start%20of%20record%20*/%0a%20%20%20%20uint%20options;%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20/*%20OR%20of%20HA_CREATE_%20options%20*/%0a%20%20%20%20uint%20raid_type,raid_chunks;%0a%20%20%20%20uint%20merge_insert_method;%0a%20%20%20%20uint%20extra_size;%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20/*%20length%20of%20extra%20data%20segment%20*/%0a%20%20%20%20bool%20table_existed;%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20/*%201%20in%20create%20if%20table%20existed%20*/%0a%20%20%20%20bool%20frm_only;%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20/*%201%20if%20no%20ha_create_table%28%29%20*/%0a%20%20%20%20bool%20varchar;%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20/*%201%20if%20table%20has%20a%20VARCHAR%20*/%0a%7d%20HA_CREATE_INFO;">
 &lt;i class="bi bi-copy">&lt;/i>
 &lt;/button>
 &lt;/div>
 

 
 &lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">typedef&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> &lt;span style="color:#a6e22e">st_ha_create_information&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CHARSET_INFO &lt;span style="color:#f92672">*&lt;/span>table_charset, &lt;span style="color:#f92672">*&lt;/span>default_table_charset;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LEX_STRING connect_string;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>comment,&lt;span style="color:#f92672">*&lt;/span>password;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>data_file_name, &lt;span style="color:#f92672">*&lt;/span>index_file_name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>alias;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ulonglong max_rows,min_rows;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ulonglong auto_increment_value;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ulong table_options;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ulong avg_row_length;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ulong raid_chunksize;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ulong used_fields;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> SQL_LIST merge_list;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">db_type&lt;/span> db_type;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">enum&lt;/span> &lt;span style="color:#a6e22e">row_type&lt;/span> row_type;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uint null_bits; &lt;span style="color:#75715e">/* NULL bits at start of record */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uint options; &lt;span style="color:#75715e">/* OR of HA_CREATE_ options */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uint raid_type,raid_chunks;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uint merge_insert_method;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uint extra_size; &lt;span style="color:#75715e">/* length of extra data segment */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> table_existed; &lt;span style="color:#75715e">/* 1 in create if table existed */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> frm_only; &lt;span style="color:#75715e">/* 1 if no ha_create_table() */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">bool&lt;/span> varchar; &lt;span style="color:#75715e">/* 1 if table has a VARCHAR */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} HA_CREATE_INFO;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
 
&lt;/div>
&lt;ul>
&lt;li>storage engine 이 파일 기반이라는 가정하에 &lt;code>form&lt;/code>, &lt;code>info&lt;/code>는 신경 쓰지 않아도 됨.&lt;/li>
&lt;li>csv engine 같은 경우 아래와 같이 구현되어 있음&lt;/li>
&lt;/ul>







&lt;div class="codeblock">
 
 &lt;div class="copy-button-box">
 &lt;button class="copy-button" state="copy" data="#ZgotmplZ">
 &lt;i class="bi bi-copy">&lt;/i>
 &lt;/button>
 &lt;/div>
 

 
 &lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> ha_tina&lt;span style="color:#f92672">::&lt;/span>create(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>name, TABLE &lt;span style="color:#f92672">*&lt;/span>table_arg,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HA_CREATE_INFO &lt;span style="color:#f92672">*&lt;/span>create_info)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">char&lt;/span> name_buff[FN_REFLEN];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> File create_file;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DBUG_ENTER(&lt;span style="color:#e6db74">&amp;#34;ha_tina::create&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> ((create_file&lt;span style="color:#f92672">=&lt;/span> my_create(fn_format(name_buff, name, &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;.CSV&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MY_REPLACE_EXT&lt;span style="color:#f92672">|&lt;/span>MY_UNPACK_FILENAME),&lt;span style="color:#ae81ff">0&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> O_RDWR &lt;span style="color:#f92672">|&lt;/span> O_TRUNC,MYF(MY_WME))) &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DBUG_RETURN(&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> my_close(create_file,MYF(&lt;span style="color:#ae81ff">0&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DBUG_RETURN(&lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
 
&lt;/div>
&lt;ul>
&lt;li>흐음&amp;hellip;. 딱히 예제 코드에서 수정할게 없어보여서 거의 그대로 가져왔다.&lt;/li>
&lt;li>변경한 부분은 확장자 부분이랑, ccls에서 warning을 뱉길레 if문 안에 assignment구문을 넣지 않고 밖으로 뺴기만 했다.&lt;/li>
&lt;li>그리고 원래 example source에 thread variable 을 설정하는 예시로 현재 사용하고 있는 Thread(아마도 내 추측으로는 client의 connection과 동일한 맥락을 가질듯, server에서는 connection 당 1개의 thread가 붙어서 담당한다고 알고 있음, 이건 위에 Overview 참고)마다 생성시킨 Table 개수를 tracking 하는 코드가 있었는데, 굳이 문제가 안될것 같아서 냅뒀다.&lt;/li>
&lt;/ul>
&lt;h3 id="239-opening-a-table">23.9 Opening a Table&lt;/h3>
&lt;ul>
&lt;li>read나 write 연산 전에 반드시 table data와 index file(있다면)을 열도록 되어있다.&lt;/li>
&lt;/ul>







&lt;div class="codeblock">
 
 &lt;div class="copy-button-box">
 &lt;button class="copy-button" state="copy" data="int%20open%28const%20char%20*name,%20int%20mode,%20int%20test_if_locked%29;">
 &lt;i class="bi bi-copy">&lt;/i>
 &lt;/button>
 &lt;/div>
 

 
 &lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">open&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">*&lt;/span>name, &lt;span style="color:#66d9ef">int&lt;/span> mode, &lt;span style="color:#66d9ef">int&lt;/span> test_if_locked);&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
 
&lt;/div>
&lt;ul>
&lt;li>&lt;code>name&lt;/code>은 table 의 이름&lt;/li>
&lt;li>&lt;code>mode&lt;/code>는 &lt;code>O_RDONLY&lt;/code>(Open read only) 또는 &lt;code>O_RDWR&lt;/code>(Open read/write)&lt;/li>
&lt;li>&lt;code>test_if_locked&lt;/code>는 파일을 열 때 확인해야할 내용에 대한 값이고,&lt;/li>
&lt;/ul>







&lt;div class="codeblock">
 
 &lt;div class="copy-button-box">
 &lt;button class="copy-button" state="copy" data="#define%20HA_OPEN_ABORT_IF_LOCKED%20%20%200%20%20%20/*%20default%20*/%0a#define%20HA_OPEN_WAIT_IF_LOCKED%20%20%20%201%0a#define%20HA_OPEN_IGNORE_IF_LOCKED%20%202%0a#define%20HA_OPEN_TMP_TABLE%20%20%20%20%20%20%20%20%204%20%20%20/*%20Table%20is%20a%20temp%20table%20*/%0a#define%20HA_OPEN_DELAY_KEY_WRITE%20%20%208%20%20%20/*%20Don%27t%20update%20index%20*/%0a#define%20HA_OPEN_ABORT_IF_CRASHED%20%2016%0a#define%20HA_OPEN_FOR_REPAIR%20%20%20%20%20%20%20%2032%20%20/*%20open%20even%20if%20crashed%20*/">
 &lt;i class="bi bi-copy">&lt;/i>
 &lt;/button>
 &lt;/div>
 

 
 &lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define HA_OPEN_ABORT_IF_LOCKED 0 &lt;/span>&lt;span style="color:#75715e">/* default */&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define HA_OPEN_WAIT_IF_LOCKED 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define HA_OPEN_IGNORE_IF_LOCKED 2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define HA_OPEN_TMP_TABLE 4 &lt;/span>&lt;span style="color:#75715e">/* Table is a temp table */&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define HA_OPEN_DELAY_KEY_WRITE 8 &lt;/span>&lt;span style="color:#75715e">/* Don&amp;#39;t update index */&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define HA_OPEN_ABORT_IF_CRASHED 16
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define HA_OPEN_FOR_REPAIR 32 &lt;/span>&lt;span style="color:#75715e">/* open even if crashed */&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
 
&lt;/div>
&lt;ul>
&lt;li>이 값들중 하나이다.&lt;/li>
&lt;li>lock을 어떻게 다루는지 같은건 &lt;code>get_share()&lt;/code>와 &lt;code>free_share()&lt;/code>를 참조하라고 한다.&lt;/li>
&lt;/ul>
&lt;h4 id="코드-보면서-느낀거">코드 보면서 느낀거&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>&lt;code>handler::ha_open&lt;/code> 이라는 메서드가 존재하는데 얘가 &lt;code>handler::open&lt;/code>을 호출하는 구조이다. (정확히 여기서는 &lt;code>handler&lt;/code>를 상속받은 custom storage engine의 open이라는 메서드)&lt;/p></description></item></channel></rss>