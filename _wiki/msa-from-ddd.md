---
layout  : wiki
title   : 도메인 주도 설계로 시작하는 마이크로서비스 개발
summary : 도메인 주도 설계로 시작하는 마이크로서비스 개발 책 정리
date    : 2021-07-22 02:56:55 +0900
lastmod : 2021-07-22 03:24:21 +0900
tags    : [ddd, msa]
draft   : false
parent  : Book reviews
---

# 1. 아마존 비지니스 민첩성의 비밀
## 1.1 성공한 인터넷 기업들과 비지니스 민첩성
 * Amazon, Netflix, Uber
 * 아마존 배포 속도 : 11.6초 마다 아마존 쇼핑몰의 소스코드가 변경되어 배포된다.
 * 클라우드 인프라의 등장 : AWS(Amazon Web Service), Azure, GCP(Google Cloud Platform)
 * 스케일 업과 스케일 아웃:
   * 스케일업은 기존 시스템 자체의 물리적 용량을 증가시켜 성능을 높이는 방법이다. 사용량이 많아지는 것은 데이터 처리가 증가한다는 것이고 시스템을 담을 그릇도 커져야 한다.
   * 스케일 아웃은 기존 시스템과 용량이 같은 다수의 장비를 병행 추가해서 가용성을 높이는 방법이다. 즉, 사용량을 분산시켜 전체적으로 장애 없이 운영되게 한다.
 * 클라우드 프렌들리와 클라우드 네이티브:
   * Cloud Friendly Application : 큰 덩어리로 클라우드 환경에 올라갈 수 있게만 한 어플리케이션
   * Cloud Native Application : 독립적으로 분리되어 배포될 수 있는 조각으로 구성된 어플리케이션
   * 필자는 클라우드 프렌들리에서 클라우드 네이티브로 전이해야한다고 주장

## 1.2 마이크로서비스란 무엇인가?
### 모노리스와 마이크로서비스 비교
 * 모노리스(monolith):
   * 하나의 단위로 개발되는 일체식 어플리케이션 보통은 3티어(3 tier)라고 불리는 사용자 인터페이스와 데이터베이스, 서버 어플리케이션으로 구성된다.
   * 논리적인 단일체로서 아무리 작은 변화에도 새로운 버전으로 전체를 빌드해서 배포해야 한다.
   * 로드 밸런서를 앞에 두고 여러 인스턴스 위에 큰 덩어리를 복제해 수평으로 확장한다.
 * 마이크로서비스(microservice):
   * 서버 측이 여러개의 조각으로 구성돼 각 서비스가 별개의 인스턴스로 로딩된다.

### SOA와 마이크로서비스
 * modulearity 개념의 발전 흐름:
   * structured 방법론 -> CBD(Component Based Development) -> SOA(Service Oriented Architecture)
 * SOA는 구체적이지 않고 이론적이다.
 * MSA는 이러한 SOA가 클라우드 인프라의 등장으로 하드웨어를 유연하게 다룰 수 있게 되면서 비로소 실현되어 성공적으로 증명된 시스템 구조이다.
 * Polyglot : 특정 서비스를 구축하는 데 사용되는 언어나 저장소를 자율적으로 선택할 수 있는 방식
   * CBD/SOA 접근법에서는 어플리케이션은 모듈별로 분리했지만 저장소까지는 부리하지 못했다.
   * MSA에서는:
     * 서비스별 저장소를 분리해서 다른 서비스가 저장소를 직접 호출하지 못하도록 캡슐화한다. 즉, 다른 서비스의 저장소에 접근하는 수단은 API밖에 없다.
     * REST API 같은 가벼운 개방형 표준을 사용해 각 서비스가 느슨하게 연계되고 누구나 쉽게 사용할 수 있다.

## 1.3 마이크로서비스를 위한 조건은 무엇인가?
### 조직의 변화: 업무 기능 중심 팀
 * 콘웨이 법칙(Conway's law) : 시스템을 개발할 때 항상 시스템의 모양이 팀의 의사소통 구조를 반영하는 것을 말한다.
 * 마이크로서비스를 만드는 팀은 업무 기능 중심의 팀이여야 한다.
 * two pizza team : 피자 두판으로 서로 빈번히 의사소통하며 함께 식사할 수 있는 정도의 팀원 수

### 관리체계의 변화: 자율적인 분권 거버넌스, 폴리글랏
 * 각 팀별로 알아서 자율적으로 서비스 성격에 맞는 최적의 언어와 저장소를 자율적으로 선택한다.

### 개발 생명주기의 변화: 프로젝트가 아니라 제품 중심으로
 * agile(애자일):
   * 2~3주 단위의 Sprint(스프린트)
 * 마이크로서비스느 계속 피드백을 받아 지속적으로 변화, 개선되고 향상되는 존재다.

### 개발 환경의 변화: 인프라 자동화
 * 개발 환경 준비(인프라)
 * 개발(분석/설계/개발)
 * 개발지원과정(빌드/테스트/배포)
 * 빌드/배포 파이프라인:
   * 소스코드 빌드 -> 개발 환경 배포 -> 스테이징 환경 배포 -> 운영환경 배포
   * Infrastructure as Code: 코드를 이용해 인프라 구성부터 애플리케이션 빌드, 배포를 정의하는 것

### 저장소의 변화: 통합 저장소가 아닌 분권 데이터 관리
 * 데이터 일관성 처리:
   * two-phase commit : 항상 모든 서비스가 지원하는 것은 아니다.
   * 비동기 이벤트 처리를 통한 협업 -> 결과적 일관성(Eventual Consistency):
     * 두 서비스의 데이터가 일시적으로 불일치하는 시점에 있고 일관성이 없느 ㄴ상태이지만 결국에는 두 데이터가 같아진다는 개념이다.

### 위기 대응 방식의 변화: 실패를 고려한 설계
 * 버너 보겔스(Werner Vogels) : 소프트웨어는 모두 실패한다.
 * 내결함성(fault tolerance)
 * 서킷 브레이커(circuit breaker) 패턴

## 1.4 정리
 * 비즈니스 민첩성을 위한 3가지 요소:
   * 점진 반복적인 개발 프로세스
   * 유연하고 자동화된 개발 환경
   * 자율적인 업무 기능 팀과 개발 문화
