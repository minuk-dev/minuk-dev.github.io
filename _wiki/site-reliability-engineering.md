---
layout  : wiki
title   : 사이트 신뢰성 엔지니어링
date    : 2022-10-16 17:00:35 +0900
lastmod : 2022-10-26 23:05:19 +0900
tags    : [sre]
draft   : true
parent  : Book reviews
---

## 1. 소개
- 직접 비용, 간접 비용

### 서비스 관리에 대한 구글의 해법: 사이트 신뢰성 엔지니어링
- SRE 중 50~60% 는 구글의 소프트웨어 엔지니어다.
- SRE팀은 반드시 50%의 시간을 오롯이 개발을 위해 활용해야한다.:
  - 만약 이에 미치지 못한다면, 운영에 대한 부담이 개발팀에 전가되거나 혹은 운영 책임이 없음에도 새로운 팀원이 팀에 배정되는 현상이 발생하고 있음을 암시하고 있다.

### SRE의 신조
- Availability, Latency, Performance, Efficiency, Change Management, Monitoring, Emergency response, capacity planning

#### 지속적으로 엔지니어링에 집중한다.
- 모든 심각한 장애에 대해서는 알림 여부를 떠나 반드시 포스트모텀을 작성해야한다.:
  - 모니터링되지 않고 있는 부분을 알 수 있기 때문이다.

#### 서비스의 안정성을 유지하면서 변화를 최대한 수용한다.
- 에러 예산:
  - 더 이상 무정지 시스템 같은 목표를 세우지 않는다.
  - 예측 가능한 시스템 정지

#### 모니터링
- 알림(alert) : 어떤 문제가 발생했거나 발생하려고 할 때 상황을 개선하기 위해 사람이 즉각적으로 어떤 대응을 취해야 한다는 것을 알린다.
- 티켓(tickets) : 사람의 대응이 필요하지만 즉가적인 대응이 필요하지는 않는 상황을 의미한다.
- 로깅(logging) : 누군가 이 정보를 반드시 확인해야 할 필요는 없지만 향후 분석이나 조사를 위해 기록되는 내용이다.

#### 긴급 대응
- MTTF(Mean Time To Failure)
- MTTR(Mean Time To Repair)
- MTTR을 줄이기 위해서는 잘 정리된 포괄적인 행동 지침이 큰 역할을 할 수 있다. (장애 대응 지침)

#### 변화 관리
- 제품의 단계적 출시
- 문제를 빠르고 정확하게 도출하기
- 문제 발생 시 안전하게 이전 버전으로 되돌리기

#### 수요 예측과 수용 계획
- 자연적 수요에 대한 정확한 예측. 필요한 수용력을 확보하기까지의 시간에 대한 예측을 이끌어낼 수 있다.
- 자연적 수요와 인위적 수요를 정확하게 합산하기
- 원천적인 수용력(서버, 디스크 등)을 바탕으로 서비스의 수용력을 측정하기 위한 통상의 시스템 부하 테스트

#### 프로비저닝
- 프로비저닝 : 변화 관리와 수용 계획을 합한 개념

#### 효율성과 성능
- 서비스의 효율성을 결정짓는 중요한 요소들 : 수요(부하), 수용력, 소프트웨어의 효율성

## 2. SRE 관점에서 바라본 구글의 프로덕션 환경
### 하드웨어
- 머신(Machine) : 하드웨어(혹은 가상머신, Virtual Machine)을 의미한다.
- 서버(server) : 서비스를 구현하는 소프트웨어를 의미한다.

### 하드웨어를 조율하는 시스템 소프트웨어
- 하드웨어 결함도 소프트웨어로 관리할 수 있다.

#### 머신 관리하기
- 보그(Borg) : 오늘날의 쿠버네티스

#### 저장소
- 저장소는 여러 계층으로 구성된다.:
  - 가장 낮은 계층은 D 계층
  - Colossus, 구글 파일 시스템의 후속 제품이다.
  - 콜로서스를 바탕으로 데이터베이스와 유사한 서비스들이 존재한다.:
    - Spanner, Bigtable, Blobstore

#### 네트워킹
- GSLB(Global Software Load Balancer):
  - DNS 요청에 대한 지역적 로드밸렁싱
  - 사용자 서비스 수준에서의 로드밸런싱
  - 원격 프로시저 호출(RPC) 수준에서의 로드밸런싱

### 기타 시스템 소프트웨어
#### 잠금 서비스
- 처비(Chubby), Paxos 프로토콜
- 요즘 널리사용되는 오픈소스(k8s, kafka 등)은 etcd, zookeeper를 사용하고 이들은 raft 알고리즘으로 동작한다.

#### 모니터링과 알림
- 치명적인 문제점에 대한 알림 설정
- 행동 비교: 소프트웨어 업데이트 이후 서버가 빨라졌는가?
- 수용 계획을 위한 가장 기본적인 지표인 시간의 흐름에 따른 자원 소비 행위의 개선 여부 확인하기

### 소프트웨어 인프라스트럭처
- Protocol buffers:
  - 오늘날에는 gRPC를 사용하고 gRPC 는 대부분 Protocol Buffers 를 사용한다.

### 개발 환경
- 구글에서의 업무 흐름 중 중요한 암묵적인 합의:
  - 프로젝트 외부의 컴포넌트에서 문제가 발생하면 엔지니어는 문제를 해결하고, 변경사항(cahgnelist, CL)을 소유자에게 보내서 리뷰를 요청한 후 변경된 코드를 제출할 수 있다.
  - 엔지니어가 소속된 프로젝트의 소스 코드 변경은 반드시 리뷰를 거쳐야 한다. 모든 소프트웨어는 제출되기 전에 리뷰를 받아야 한다.

# II. 원리와 원칙들
## 3. 위험 요소 수용하기
- 사용자의 스마트폰이 99% 의 신뢰성을 가진다면, 99.99%와 99.999% 서비스는 사용자가 구별할수 없다.
- SRE는 이 점을 이용해서 위험요소, 빠른 혁신, 효과적인 서비스 운영의 균형을 잡는다. (기능, 서비스, 성능)

### 위험 요소 관리하기
- 신뢰성을 향상시킬수는 있지만 비용이 증가하는 요소들:
  - 여분의 머신/컴퓨트 자원 비용
  - 기회 비용
- 가용성 목표치를 초과 달성하려고 노력은 하되, 넘치게 초과하려고는 하지 않는다.
- 가용성 목표치를 초과 달성했다면, 기술부채를 줄이거나 윤영비용을 줄이려고 시도해야한다.

### 서비스 위험 측정하기
- 시간 기준 가용성 : 가용성 = 업타임 / (업타임 + 다운타임)
- 종합 가용성 : 가용성 = 성공한 요청 수 / 전체 요청수
- 널리 사용되는 가용성 지표를 측정하는 방법:
  - 주 단위 혹은 일 단위로 목표치에 대한 성능을 측정한다.

### 서비스의 위험 수용도
#### 소비자 대상 서비스의 위험 수용도 정의하기
- 위험 수용도를 결정하기 위해서 고려해야 하는 요소:
  - 어느 정도 수준의 위험 수용도가 요구되는가?
  - 장애의 종류에 따라 서비스에 미치는 영향이 달라지는가?
  - 지속적으로 발생하는 위험 중 어느 지점에 서비스 비용을 투입할 것인가?
  - 중요하게 고려해야 할 다른 서비스 지표로는 어떤 것들이 있는가?

- 목표 가용성 수준:
  - 사용자는 어느 정도 수준의 서비스를 기대하는가?
  - 이 서비스가 수익과 직접적으로 연관이 있는가?
  - 유료 서비스인가? 무료 서비스인가?
  - 시장에 경쟁자가 있다면 경쟁자는 어느 정도 수준의 가용성을 제공하는가?
  - 이 서비스는 개인 사용자를 위한 서비스인가? 기업 사용자를 위한 서비스인가?

- 장애의 종류:
  - 낮은 비율로 장애가 지속적으로 발생
  - 가끔이지만 전체 사이트가 다운되는 장애

- 비용:
  - 목표 가용성 수준을 높이려고 한다면 수익에 어떤 긍정적 역향이 미치는가?
  - 발생 가능한 추가 수익이 목표한 가용성 수준에 도달하기 위한 비용을 상쇄할 수 있는가?

- 기타 서비스 비용

### 인프라스트럭처 서비스의 위험 수용도 정의하기
- 목표 가용성 수준, 장애의 종류, 비용

### 에러 예산 활용해보기
- 소프트웨어 결함 허용, 테스트, 출시 빈도, 카나리 테스트 빈도와 규모

#### 에러 예산 산정하기
- SLO(Service Lead Objectives, 서비스 수준 목표)

- 제품 관리자들이 서비스의 분기별 예상 업타임을 의미하는 SLO를 산정한다.
- 실제 업타임은 제3자, 즉 우리가 보유한 모니터링 시스템으로 측정한다.
- 이 두 숫자 사이의 차이점이 분기별로 얼마만큼의 '불안정성'을 허용할 것인지를 의미하는 '예산'이 된다.
- 업타임이 SLO를 초과한다면(다시 말해, 에러 예산이 아직 남아있다면) 새로운 릴리즈를 출시할 수 있다.

#### 장점
- 제품 개발팀과 SRE팀이 혁신과 신뢰성 사이의 올바른 균형을 찾는데 필요한 기준을 제공한다.

#### 핵심 인사이트
- 서비스의 신뢰성을 관리하는 것은 위험을 관리하는 것이며, 위험을 관리하기 위해서는 비용이 소비될 수 있다.
- 100%는 절대로 올바른 신뢰성 목표치가 될 수 없다.
- 에러 예산은 SRE와 제품 개발팀 사이의 공동 소유권을 강조하며 각자의 역할을 명료하게 한다.

## 4. 서비스 수준 목표


